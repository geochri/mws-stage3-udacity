let dbpromise,num,restaurant,map;class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static openDatabase(){return idb.open("restaurantDb",1,function(e){e.createObjectStore("restaurantDb",{keyPath:"id"})})}static openReviewDatabase(){return idb.open("reviewsDb",1,function(e){e.createObjectStore("reviewsDb",{keyPath:"id"}).createIndex("restaurant_id","restaurant_id")})}static saveReviewsDatabase(e){return DBHelper.openReviewDatabase().then(t=>{if(!t)return;let r=t.transaction("reviewsDb","readwrite"),n=r.objectStore("reviewsDb");return e.forEach(e=>{n.put(e)}),r.complete})}static reviewsGetCached(e){return(dbpromise=DBHelper.openReviewDatabase()).then(e=>{if(!e)return;return e.transaction("reviewsDb").objectStore("reviewsDb").getAll()}).then(t=>(num=t.filter(t=>t.restaurant_id==parseInt(e)).length,t.filter(t=>t.restaurant_id==parseInt(e)))).catch(e=>console.log(e))}static updateReviewsDb(e){return DBHelper.openReviewDatabase().then(t=>{return t.transaction("reviewsDb","readwrite").objectStore("reviewsDb").add(e)})}static openOutboxDatabase(){return idb.open("outbox",1,function(e){e.createObjectStore("outbox",{keyPath:"createdAt"})})}static saveOutboxDatabase(e){return DBHelper.openOutboxDatabase().then(t=>{if(!t)return;let r=t.transaction("outbox","readwrite");return r.objectStore("outbox").put(e),r.complete})}static pendingForSubmitReviews(e){navigator.onLine&&e.length>0&&e.forEach(e=>{fetch("http://localhost:1337/reviews/",{method:"POST",body:JSON.stringify(e)}).then(clearOutbox())})}static clearOutbox(){if(navigator.onLine)return DBHelper.openOutboxDatabase().then(e=>{let t=e.transaction("outbox","readwrite");return t.objectStore("outbox").clear(),t.complete})}static processAllPendingReviews(){if(navigator.onLine)return DBHelper.openOutboxDatabase().then(e=>{return e.transaction("outbox").objectStore("outbox").getAll()}).then(e=>{e.forEach(function(e){fetch("http://localhost:1337/reviews/",{method:"POST",body:JSON.stringify(e)}).then(t=>{self.reviews.push(t);let r={restaurant_id:e.restaurant_id,name:e.name,rating:e.rating,comments:e.comments,createdAt:e.createdAt,id:num+100};DBHelper.updateReviewsDb(r)}).catch(e=>{callback(e,null)})})})}static saveDatabase(e){return DBHelper.openDatabase().then(function(t){if(!t)return;let r=t.transaction("restaurantDb","readwrite"),n=r.objectStore("restaurantDb");return e.forEach(function(e){n.put(e)}),r.complete})}static updateDb(e,t){return DBHelper.openDatabase().then(t=>{return t.transaction("restaurantDb").objectStore("restaurantDb").get(e,"is_favorite")}).then(e=>{e.is_favorite=t,DBHelper.openDatabase().then(t=>{t.transaction("restaurantDb","readwrite").objectStore("restaurantDb").put(e)})})}static getCachedDb(){return(dbpromise=DBHelper.openDatabase()).then(function(e){if(!e)return;return e.transaction("restaurantDb").objectStore("restaurantDb").getAll()})}static fromApi(){return fetch(DBHelper.DATABASE_URL).then(function(e){return e.json()}).then(e=>(DBHelper.saveDatabase(e),e))}static fetchRestaurants(e){return DBHelper.getCachedDb().then(e=>e.length?Promise.resolve(e):DBHelper.fromApi()).then(t=>{e(null,t)}).catch(t=>{e(t,null)})}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((r,n)=>{const a=n.find(t=>t.id==e);a?t(null,a):t("Restaurant does not exist",null)})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.filter(t=>t.cuisine_type==e);t(null,r)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.filter(t=>t.neighborhood==e);t(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,r){DBHelper.fetchRestaurants((n,a)=>{if(n)r(n,null);else{let n=a;"all"!=e&&(n=n.filter(t=>t.cuisine_type==e)),"all"!=t&&(n=n.filter(e=>e.neighborhood==t)),r(null,n)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.map((e,t)=>r[t].neighborhood),n=t.filter((e,r)=>t.indexOf(e)==r);e(null,n)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.map((e,t)=>r[t].cuisine_type),n=t.filter((e,r)=>t.indexOf(e)==r);e(null,n)}})}static fetchReview(e){return fetch("http://localhost:1337/reviews").then(function(e){return e.json()}).then(t=>{e(null,t)}).catch(t=>{e(t,null)})}static fetchReviewById(e,t){return DBHelper.reviewsGetCached(e).then(t=>t.length>1?Promise.resolve(t):fetch("http://localhost:1337/reviews/?restaurant_id="+e).then(function(e){return e.json()}).then(e=>(DBHelper.saveReviewsDatabase(e),e))).then(e=>{t(null,e)}).catch(e=>{t(e,null)})}static postReviews(e){return fetch("http://localhost:1337/reviews/",{method:"POST",body:e}).then(function(e){return e.ok?e.json():[{}]})}static markFavorite(e){let t="";return"true"===self.restaurant.is_favorite?(t=`http://localhost:1337/restaurants/${e}/?is_favorite=true`,console.log(t)):"false"===self.restaurant.is_favorite&&(t=`http://localhost:1337/restaurants/${e}/?is_favorite=false`,console.log(t)),fetch(t,{method:"PUT"}).then(function(e){return e.ok?e.json():[{}]})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph}.webp`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),document.getElementById("map").setAttribute("role","application"),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,r)=>{self.restaurant=r,r?(fillRestaurantHTML(),e(null,r)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{self.is_favorite=e.is_favorite;const t=document.getElementById("restaurant-name");t.innerHTML=e.name,"true"===e.is_favorite?t.innerHTML+='<button tabindex="0" aria-label="Mark as unfavorite place" onclick="favButton(this)" class="favorite"></button>':t.innerHTML+='<button tabindex="0" aria-label="Mark as favorite place" onclick="favButton(this)" class="un_favorite"></button>',document.getElementById("restaurant-address").innerHTML=e.address;const r=document.getElementById("restaurant-img");r.className="restaurant-img",r.setAttribute("aria-label",t.innerHTML+" restaurant"),r.setAttribute("alt",t.innerHTML+" restaurant"),r.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),DBHelper.processAllPendingReviews(),DBHelper.clearOutbox(),fetchReviewUrl()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let r in e){const n=document.createElement("tr"),a=document.createElement("td");a.innerHTML=r,a.style.color="#525252",n.appendChild(a);const i=document.createElement("td");i.innerHTML=e[r],i.style.color="#525252",n.appendChild(i),t.appendChild(n)}}),favButton=(e=>("true"===self.is_favorite?(e.classList.remove("favorite"),e.classList.add("un_favorite"),self.restaurant.is_favorite="false",self.is_favorite="false",e.setAttribute("aria-label","Mark as favorite")):(self.restaurant.is_favorite="true",self.is_favorite="true",e.setAttribute("aria-label","Mark as unfavorite"),e.classList.remove("un_favorite"),e.classList.add("favorite")),DBHelper.markFavorite(self.restaurant.id),DBHelper.updateDb(self.restaurant.id,self.restaurant.is_favorite))),fetchReviewUrl=(()=>{if(self.review)return;const e=getParameterByName("id");e?DBHelper.fetchReviewById(e,(e,t)=>{if(self.reviews=t,!t)return console.error(e),void fillReviewsHTML(null);fillReviewsHTML()}):error="No restaurant id in URL"}),addReviewButton=(()=>{const e=document.getElementById("reviews-container"),t=document.createElement("button"),r=document.createElement("a");r.innerHTML="Add Review",t.setAttribute("role","button"),t.setAttribute("id","addReviewButton"),t.setAttribute("onclick","reviewForm()"),r.style.color="#fff",t.style.backgroundColor="#854400",t.style.height="35px",t.style.width="100px",t.style.margin="10px",t.style.padding="10px",e.appendChild(t),t.disable=!1,t.hidden=!1,r.setAttribute("href","#reviewForm"),t.appendChild(r)}),reviewForm=(()=>{const e=document.getElementById("addReviewButton");e.disable=!0,e.hidden=!0;const t=document.createElement("form");t.setAttribute("class","review_form"),t.id="reviewForm",t.setAttribute("role","form"),t.setAttribute("tabindex","14"),t.setAttribute("order","0"),document.getElementById("reviews-list").setAttribute("order","1");const r=document.createElement("h2");r.innerHTML="Review Form for",r.setAttribute("role","h2"),r.id="reviewHeader";const n=document.createElement("h3");n.innerHTML=self.restaurant.name,n.setAttribute("role","h3"),n.id="reviewRestaurant";const a=document.createElement("label");a.innerHTML="Name:",a.setAttribute("for","name"),a.id="reviewName",a.setAttribute("role","label");const i=document.createElement("input");i.id="reviewInputName",i.setAttribute("role","input"),i.setAttribute("name","name"),i.setAttribute("placeholder","Enter your Name.."),i.setAttribute("required","true");const s=document.createElement("label");s.id="reviewRating",s.setAttribute("role","label"),s.setAttribute("for","rating"),s.innerHTML="Rating:",s.min="1",s.max="5";const o=document.createElement("input");o.id="reviewInputRating",o.setAttribute("name","rating"),o.setAttribute("role","input"),o.setAttribute("placeholder","Enter your Rating.. From 1 to 5."),o.setAttribute("required","true");const l=document.createElement("label");l.id="reviewComments",l.setAttribute("role","label"),l.setAttribute("for","comments"),l.innerHTML="Comments:";const u=document.createElement("textarea");u.id="reviewInputComments",u.setAttribute("role","input"),u.setAttribute("name","comments"),u.setAttribute("placeholder","Enter your Comments here.. Minimum 90 characters!"),u.setAttribute("required","true");const c=document.createElement("button");c.id="reviewSubmit",c.setAttribute("role","button"),c.setAttribute("type","button"),c.innerHTML="Submit",c.setAttribute("onclick","addReview()"),addChildIntoElement(t,[r,n,a,i,s,o,l,u,c]),document.getElementById("reviews-container").appendChild(t),t.style.height="400px",t.style.display="flex",t.style.flexDirection="column",o.style.width="150px",o.style.marginBottom="5px",i.style.width="150px",i.style.marginBottom="5px",u.style.height="100px",u.style.width="90%",u.style.marginBottom="5px",c.style.width="100px",r.style.marginBottom="10px",n.style.marginBottom="5px"}),checkValidation=(e=>{let t=!0;if(""===e[0]||e[1]<1||e[1]>5||""===e[1]||""===e[2]||e[3]<=90){t=!1;let e="Error! Please fill the empty field, or fix the the invalid input!\nKeep in mind the minimum characters for the comment are 90!!!";console.log(e),alert(e)}return t}),addReview=(()=>{let e=document.getElementById("reviewForm")[0],t=document.getElementById("reviewForm")[1],r=document.getElementById("reviewForm")[2];const n={restaurant_id:self.restaurant.id,name:e.value,rating:t.value,comments:r.value,createdAt:Date.now()};if(lista=[e.value,t.value,r.value,r.textLength],checkValidation(lista))if(navigator.onLine)DBHelper.postReviews(JSON.stringify(n)).then(e=>{self.reviews.push(e),DBHelper.updateReviewsDb(e),setTimeout(()=>{window.location.reload()},100),alert("Status of Submited Review: Success!")}).catch(e=>{self.reviews.push(n),setTimeout(()=>{window.location.reload()},1e3)});else if(!navigator.onLine){DBHelper.saveOutboxDatabase(n),document.getElementById("reviewForm").reset()}}),addChildIntoElement=((e,t)=>{t.forEach(t=>{e.appendChild(t)})}),fillReviewsHTML=((e=self.reviews)=>{const t=document.getElementById("reviews-container"),r=document.createElement("h2");if(r.innerHTML="Reviews",t.appendChild(r),addReviewButton(),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const n=document.getElementById("reviews-list");e.forEach(e=>{n.appendChild(createReviewHTML(e))}),t.appendChild(n)}),createReviewHTML=(e=>{const t=document.createElement("li");t.setAttribute("tabindex","13"),t.setAttribute("role","listitem");const r=document.createElement("p");r.innerHTML=e.name,r.style.textAlign="left",r.style.width="50%",r.style.order="0",r.style.fontWeight="bold",r.style.fontSize="16px",r.style.color="#932C2A",t.appendChild(r);const n=document.createElement("p");n.innerHTML=new Date(e.createdAt).toGMTString(),n.style.textAlign="right",n.style.width="50%",n.style.fontSize="16px",n.style.fontStyle="oblique",n.style.textDecoration="underline",n.style.order="0",t.appendChild(n);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,a.style.backgroundColor="#333333",a.style.borderRadius="5px 5px",a.style.textAlign="center",a.style.fontWeight="bold",a.style.fontSize="17px",a.style.height="25px",a.style.width="100px",a.style.color="#FFB52E",a.style.order="1",t.appendChild(a);const i=document.createElement("p");return i.innerHTML=e.comments,i.style.order="2",i.style.lineHeight="1.6",i.style.textAlign="justify",t.appendChild(i),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),r=document.createElement("li");r.innerHTML=e.name,t.appendChild(r)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const r=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIl0sIm5hbWVzIjpbImRicHJvbWlzZSIsIm51bSIsInJlc3RhdXJhbnQiLCJtYXAiLCJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsImlkYiIsIm9wZW4iLCJ1cGdyYWRlRGIiLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJjcmVhdGVJbmRleCIsImRhdGEiLCJvcGVuUmV2aWV3RGF0YWJhc2UiLCJ0aGVuIiwiZGIiLCJ0eCIsInRyYW5zYWN0aW9uIiwic3RvcmUiLCJvYmplY3RTdG9yZSIsImZvckVhY2giLCJyZXZpZXciLCJwdXQiLCJjb21wbGV0ZSIsImlkIiwiZ2V0QWxsIiwicmVzIiwiZmlsdGVyIiwiciIsInJlc3RhdXJhbnRfaWQiLCJwYXJzZUludCIsImxlbmd0aCIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwiYWRkIiwib3Blbk91dGJveERhdGFiYXNlIiwicmV2aWV3cyIsIm5hdmlnYXRvciIsIm9uTGluZSIsImZldGNoIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJjbGVhck91dGJveCIsImNsZWFyIiwicmVzcG9uc2UiLCJyZXN1bHQiLCJzZWxmIiwicHVzaCIsIm5hbWUiLCJyYXRpbmciLCJjb21tZW50cyIsImNyZWF0ZWRBdCIsInVwZGF0ZVJldmlld3NEYiIsImVyIiwiY2FsbGJhY2siLCJvcGVuRGF0YWJhc2UiLCJ2YWwiLCJnZXQiLCJvYmplY3QiLCJpc19mYXZvcml0ZSIsImpzb24iLCJyZXN0YXVyYW50cyIsInNhdmVEYXRhYmFzZSIsImdldENhY2hlZERiIiwiUHJvbWlzZSIsInJlc29sdmUiLCJmcm9tQXBpIiwiZmV0Y2hSZXN0YXVyYW50cyIsImZpbmQiLCJjdWlzaW5lIiwicmVzdWx0cyIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsIm5laWdoYm9yaG9vZHMiLCJ2IiwiaSIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsInJldmlld3NHZXRDYWNoZWQiLCJzYXZlUmV2aWV3c0RhdGFiYXNlIiwib2siLCJtYXJrIiwicGhvdG9ncmFwaCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImxhdGxuZyIsInRpdGxlIiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsImFuaW1hdGlvbiIsIkFuaW1hdGlvbiIsIkRST1AiLCJ3aW5kb3ciLCJpbml0TWFwIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsIk1hcCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ6b29tIiwiY2VudGVyIiwic2Nyb2xsd2hlZWwiLCJzZXRBdHRyaWJ1dGUiLCJmaWxsQnJlYWRjcnVtYiIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiaW5uZXJIVE1MIiwiYWRkcmVzcyIsImltYWdlIiwiY2xhc3NOYW1lIiwic3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50Iiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJwcm9jZXNzQWxsUGVuZGluZ1Jldmlld3MiLCJmZXRjaFJldmlld1VybCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJjcmVhdGVFbGVtZW50IiwiZGF5Iiwic3R5bGUiLCJjb2xvciIsImFwcGVuZENoaWxkIiwidGltZSIsImZhdkJ1dHRvbiIsImVsZW1lbnQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJtYXJrRmF2b3JpdGUiLCJ1cGRhdGVEYiIsImZldGNoUmV2aWV3QnlJZCIsImZpbGxSZXZpZXdzSFRNTCIsImFkZFJldmlld0J1dHRvbiIsImNvbnRhaW5lciIsImFkZFJldmlld0J1dHRvbjIiLCJiYWNrZ3JvdW5kQ29sb3IiLCJoZWlnaHQiLCJ3aWR0aCIsIm1hcmdpbiIsInBhZGRpbmciLCJkaXNhYmxlIiwiaGlkZGVuIiwicmV2aWV3Rm9ybSIsInJldmlld0hlYWRlciIsInJldmlld1Jlc3RhdXJhbnQiLCJyZXZpZXdOYW1lIiwicmV2aWV3SW5wdXROYW1lIiwicmV2aWV3UmF0aW5nIiwibWluIiwibWF4IiwicmV2aWV3SW5wdXRSYXRpbmciLCJyZXZpZXdDb21tZW50cyIsInJldmlld0lucHV0Q29tbWVudHMiLCJyZXZpZXdTdWJtaXQiLCJhZGRDaGlsZEludG9FbGVtZW50IiwiZGlzcGxheSIsImZsZXhEaXJlY3Rpb24iLCJtYXJnaW5Cb3R0b20iLCJjaGVja1ZhbGlkYXRpb24iLCJjaGVja2xpc3QiLCJ2YWxpZCIsImVycm9yTWVzc2FnZSIsImFsZXJ0IiwiYWRkUmV2aWV3IiwidmFsdWUiLCJEYXRlIiwibm93IiwibGlzdGEiLCJ0ZXh0TGVuZ3RoIiwicG9zdFJldmlld3MiLCJzZXRUaW1lb3V0IiwibG9jYXRpb24iLCJyZWxvYWQiLCJlcnIiLCJzYXZlT3V0Ym94RGF0YWJhc2UiLCJyZXNldCIsImNoaWxkcmVuIiwiY2hpbGQiLCJub1Jldmlld3MiLCJ1bCIsImNyZWF0ZVJldmlld0hUTUwiLCJsaSIsInRleHRBbGlnbiIsIm9yZGVyIiwiZm9udFdlaWdodCIsImZvbnRTaXplIiwiZGF0ZSIsInRvR01UU3RyaW5nIiwiZm9udFN0eWxlIiwidGV4dERlY29yYXRpb24iLCJib3JkZXJSYWRpdXMiLCJsaW5lSGVpZ2h0IiwiYnJlYWRjcnVtYiIsImhyZWYiLCJyZXBsYWNlIiwiUmVnRXhwIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCJdLCJtYXBwaW5ncyI6IkFBa0JBLElBQUlBLFVBQ0FDLElBOGlCQUMsV0FDQUMsVUE5aUJFQyxTQVNKQywwQkFNRSxNQUFPLG9DQU9UQyxzQkFLRSxPQUFPQyxJQUFJQyxLQUFLLGVBQWdCLEVBQUcsU0FBVUMsR0FDM0NBLEVBQVVDLGtCQUFrQixnQkFDMUJDLFFBQVMsU0FTZkwsNEJBQ0UsT0FBT0Ms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QU84RCxxQkFBdUI5RixFQUFPZ0MsU0FFckNBLEVBQU84RSxNQUFNZSxnQkFBa0IsVUFDL0I3RixFQUFPOEUsTUFBTXNFLGFBQWUsVUFDNUJwSixFQUFPOEUsTUFBTThELFVBQVksU0FDekI1SSxFQUFPOEUsTUFBTWdFLFdBQWEsT0FDMUI5SSxFQUFPOEUsTUFBTWlFLFNBQVcsT0FDeEIvSSxFQUFPOEUsTUFBTWdCLE9BQVMsT0FDdEI5RixFQUFPOEUsTUFBTWlCLE1BQVEsUUFDckIvRixFQUFPOEUsTUFBTUMsTUFBUSxVQUNyQi9FLEVBQU84RSxNQUFNK0QsTUFBUSxJQUVyQkYsRUFBRzNELFlBQVloRixHQUVmLE1BQU1DLEVBQVdrRCxTQUFTeUIsY0FBYyxLQVF4QyxPQVBBM0UsRUFBUzZELFVBQVk5RixFQUFPaUMsU0FDNUJBLEVBQVM2RSxNQUFNK0QsTUFBUSxJQUN2QjVJLEVBQVM2RSxNQUFNdUUsV0FBYSxNQUM1QnBKLEVBQVM2RSxNQUFNOEQsVUFBWSxVQUUzQkQsRUFBRzNELFlBQVkvRSxHQUVSMEksSUFPVGxGLGVBQWlCLEVBQUM3RyxFQUFhaUQsS0FBS2pELGNBQ2xDLE1BQU0wTSxFQUFhbkcsU0FBU0MsZUFBZSxjQUNyQ3VGLEVBQUt4RixTQUFTeUIsY0FBYyxNQUNsQytELEVBQUc3RSxVQUFZbEgsRUFBV21ELEtBQzFCdUosRUFBV3RFLFlBQVkyRCxLQU96QmhGLG1CQUFxQixFQUFDNUQsRUFBTTJDLEtBQ3JCQSxJQUNIQSxFQUFNSyxPQUFPa0YsU0FBU3NCLE1BRXhCeEosRUFBT0EsRUFBS3lKLFFBQVEsVUFBVyxRQUMvQixNQUNNbkksRUFEUSxJQUFJb0ksY0FBYzFKLHNCQUNWMkosS0FBS2hILEdBQzNCLE9BQUtyQixFQUdBQSxFQUFRLEdBR05zSSxtQkFBbUJ0SSxFQUFRLEdBQUdtSSxRQUFRLE1BQU8sTUFGM0MsR0FIQSIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludCBcInJlcXVpcmUtanNkb2NcIjogW1wiZXJyb3JcIiwge1xuICAgIFwicmVxdWlyZVwiOiB7XG4gICAgICAgIFwiRnVuY3Rpb25EZWNsYXJhdGlvblwiOiB0cnVlLFxuICAgICAgICBcIk1ldGhvZERlZmluaXRpb25cIjogZmFsc2UsXG4gICAgICAgIFwiQ2xhc3NEZWNsYXJhdGlvblwiOiBmYWxzZSxcbiAgICAgICAgXCJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvblwiOiBmYWxzZSxcbiAgICAgICAgXCJGdW5jdGlvbkV4cHJlc3Npb25cIjogZmFsc2VcbiAgICB9XG59XSovXG4vKiBlc2xpbnQgdmFsaWQtanNkb2M6IFwiZXJyb3JcIiovXG4vKiBlc2xpbnQgbWF4LWxlbjogW1wiZXJyb3JcIiwgeyBcImNvZGVcIjogMjAwIH1dKi9cbi8qIGVzbGludCBuby11bnVzZWQtdmFyczogW1wiZXJyb3JcIiwgeyBcInZhcnNcIjogXCJsb2NhbFwiIH1dKi9cbi8qIGVzbGludCBicmFjZS1zdHlsZTogWzAseyBcImFsbG93U2luZ2xlTGluZVwiOiB0cnVlIH1dKi9cbi8vIGltcG9ydCBpZGIgZnJvbSBcImlkYlwiO1xuXG4vKipcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxuICovXG5sZXQgZGJwcm9taXNlO1xubGV0IG51bTtcbmNsYXNzIERCSGVscGVyIHtcbiAgLypcbiAgICogRGF0YWJhc2UgVVJMLlxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXG4gICAqL1xuLy8gIGNvbnN0IHBvcnQgPSAnMTMzNyc7XG4vLyAgY29uc3QgaG9zdCA9ICdodHRwOi8vbG9jYWxob3N0Oic7XG5cblxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcbiAgIC8qXG4gICAgKiBjb25zdCBwb3J0ID0gODAwMCAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XG4gICAgKiByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9kYXRhL3Jlc3RhdXJhbnRzLmpzb25gO1xuICAgICovXG4gICAgY29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIHJlc3RhdXJhbnREYXRhYmFzZVxuICAgKi9cblxuICBzdGF0aWMgb3BlbkRhdGFiYXNlKCkge1xuICAgIC8vIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpe1xuICAgIC8vICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgLy8gfVxuXG4gICAgcmV0dXJuIGlkYi5vcGVuKCdyZXN0YXVyYW50RGInLCAxLCBmdW5jdGlvbih1cGdyYWRlRGIpIHtcbiAgICAgIHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudERiJywge1xuICAgICAgICBrZXlQYXRoOiAnaWQnfSk7XG4gICAgICAvLyBzdG9yZS5jcmVhdGVJbmRleCgnYnktaWQnLCdpZCcpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBSZXZpZXcgRGF0YWJhc2UhXG4gICAqL1xuXG4gICBzdGF0aWMgb3BlblJldmlld0RhdGFiYXNlKCkge1xuICAgICByZXR1cm4gaWRiLm9wZW4oJ3Jldmlld3NEYicsIDEsIGZ1bmN0aW9uKHVwZ3JhZGVEYikge1xuICAgICAgIHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgncmV2aWV3c0RiJywge1xuICAgICAgICBrZXlQYXRoOiAnaWQnfSkuY3JlYXRlSW5kZXgoJ3Jlc3RhdXJhbnRfaWQnLCAncmVzdGF1cmFudF9pZCcpO1xuICAgICB9KTtcbiAgIH1cblxuICAgLyoqXG4gICAgKiBTYXZlIGRhdGEgdG8gUmV2aWV3c0RhdGFiYXNlXG4gICAgKi9cblxuICAgc3RhdGljIHNhdmVSZXZpZXdzRGF0YWJhc2UoZGF0YSkge1xuICAgICByZXR1cm4gREJIZWxwZXIub3BlblJldmlld0RhdGFiYXNlKCkudGhlbigoZGIpID0+IHtcbiAgICAgICBpZiAoIWRiKSByZXR1cm47XG4gICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3NEYicsICdyZWFkd3JpdGUnKTtcbiAgICAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmV2aWV3c0RiJyk7XG4gICAgICAgZGF0YS5mb3JFYWNoKChyZXZpZXcpID0+IHtcbiAgICAgICAgIHN0b3JlLnB1dChyZXZpZXcpO1xuICAgICAgIH0pO1xuICAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcbiAgICAgfSk7XG4gICB9XG5cbiAgIC8qKlxuICAgICogR2V0dGluZyBkYXRhIGZyb20gUmV2aWV3c0RhdGFiYXNlXG4gICAgKi9cblxuICAgc3RhdGljIHJldmlld3NHZXRDYWNoZWQoaWQpIHtcbiAgICAgZGJwcm9taXNlID0gREJIZWxwZXIub3BlblJldmlld0RhdGFiYXNlKCk7XG4gICAgIHJldHVybiBkYnByb21pc2UudGhlbigoZGIpID0+IHtcbiAgICAgICBpZiAoIWRiKSByZXR1cm47XG4gICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3NEYicpO1xuICAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXZpZXdzRGInKTtcbiAgICAgICByZXR1cm4gc3RvcmUuZ2V0QWxsKCk7XG4gICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgIG51bT1yZXMuZmlsdGVyKChyKSA9PiByLnJlc3RhdXJhbnRfaWQ9PXBhcnNlSW50KGlkKSkubGVuZ3RoO1xuICAgICAgIC8vY29uc29sZS5sb2cobnVtKVxuICAgICAgIHJldHVybiByZXMuZmlsdGVyKChyKSA9PiByLnJlc3RhdXJhbnRfaWQ9PXBhcnNlSW50KGlkKSk7XG4gICAgIH0pLmNhdGNoKChlcnJvcikgPT4gY29uc29sZS5sb2coZXJyb3IpKTtcbiAgIH1cblxuICAgLyoqXG4gICAgKiBVcGRhdGUgdGhlIFJldmlldyBEYXRhYmFzZSBhZnRlciBwb3N0IVxuICAgICovXG5cbiAgIHN0YXRpYyB1cGRhdGVSZXZpZXdzRGIocmV2aWV3KSB7XG4gICAgIHJldHVybiBEQkhlbHBlci5vcGVuUmV2aWV3RGF0YWJhc2UoKS50aGVuKChkYikgPT4ge1xuICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzRGInLCAncmVhZHdyaXRlJyk7XG4gICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jldmlld3NEYicpO1xuICAgICAgIC8vIGxldCB0ZW1wID0gcmV2aWV3O1xuICAgICAgIHJldHVybiBzdG9yZS5hZGQocmV2aWV3KTtcbiAgICAgfSk7XG4gICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBPdXRib3ggZGF0YWJhc2UhXG4gICAqL1xuXG4gICAgc3RhdGljIG9wZW5PdXRib3hEYXRhYmFzZSgpIHtcbiAgICAgIHJldHVybiBpZGIub3Blbignb3V0Ym94JywgMSwgZnVuY3Rpb24odXBncmFkZURiKSB7XG4gICAgICAgIHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgnb3V0Ym94Jywge1xuICAgICAgICBrZXlQYXRoOiAnY3JlYXRlZEF0J30pO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV2aWV3IFNhdmluZyBvbiBPdXRib3ggRGF0YWJhc2VcbiAgICAgKi9cblxuICAgIHN0YXRpYyBzYXZlT3V0Ym94RGF0YWJhc2UoZGF0YSkge1xuICAgICAgcmV0dXJuIERCSGVscGVyLm9wZW5PdXRib3hEYXRhYmFzZSgpLnRoZW4oKGRiKSA9PiB7XG4gICAgICAgIGlmICghZGIpIHJldHVybjtcbiAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ291dGJveCcsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ291dGJveCcpO1xuICAgICAgLy8gIGRhdGEuZm9yRWFjaCgocmV2aWV3KSA9PiB7XG4gICAgICAvLyAgICBzdG9yZS5wdXQocmV2aWV3KTtcbiAgICAgIC8vICB9KTtcbiAgICAgICAgc3RvcmUucHV0KGRhdGEpO1xuICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiAgQ2hlY2tpbmcgcmV2aWV3IGFuZCBvbmxpbmUgc3RhdHVzICYmIHN1Ym1pdCAtIFBlbmRpbmcgYWN0aW9uISFcbiAgICAgKi9cblxuICAgIHN0YXRpYyBwZW5kaW5nRm9yU3VibWl0UmV2aWV3cyhyZXZpZXdzKSB7XG4gICAgICBpZiAobmF2aWdhdG9yLm9uTGluZSAmJiByZXZpZXdzLmxlbmd0aD4wKSB7XG4gICAgICAgIHJldmlld3MuZm9yRWFjaCgocmV2aWV3KSA9PiB7XG4gICAgICAgICAgZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzLycsIHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmV2aWV3KSxcbiAgICAgICAgICB9KS50aGVuKGNsZWFyT3V0Ym94KCkpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbGVhcmluZyBPdXRib3ggRGF0YWJhc2UhXG4gICAgICovXG5cbiAgICBzdGF0aWMgY2xlYXJPdXRib3goKSB7XG4gICAgICBpZiAobmF2aWdhdG9yLm9uTGluZSkge1xuICAgICAgcmV0dXJuIERCSGVscGVyLm9wZW5PdXRib3hEYXRhYmFzZSgpLnRoZW4oKGRiKSA9PntcbiAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ291dGJveCcsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ291dGJveCcpO1xuICAgICAgICBzdG9yZS5jbGVhcigpO1xuICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XG4gICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIE9ubGluZSBzdGF0dXMgY2hlY2sgJiYgc3VibWl0IHBlbmRpbmcgcmV2aWV3cyEhXG4gICAgICovXG5cbiAgICBzdGF0aWMgcHJvY2Vzc0FsbFBlbmRpbmdSZXZpZXdzKCkge1xuICAgICAgaWYgKG5hdmlnYXRvci5vbkxpbmUpIHtcbiAgICAgICAgcmV0dXJuIERCSGVscGVyLm9wZW5PdXRib3hEYXRhYmFzZSgpLnRoZW4oKGRiKSA9PiB7XG4gICAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ291dGJveCcpO1xuICAgICAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdvdXRib3gnKTtcbiAgICAgICAgICByZXR1cm4gc3RvcmUuZ2V0QWxsKCk7XG4gICAgICAgIH0pLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgLy8gcGVuZGluZ0ZvclN1Ym1pdFJldmlld3MocmVzcG9uc2UpO1xuICAgICAgICAgIHJlc3BvbnNlLmZvckVhY2goZnVuY3Rpb24ocmV2aWV3KSB7XG4gICAgICAgICAgICAvL2NvbnN0IHJldiA9IHtcbiAgICAgICAgICAgIC8vICAncmVzdGF1cmFudF9pZCc6IHJldmlldy5yZXN0YXVyYW50X2lkLFxuICAgICAgICAgICAgLy8gICduYW1lJzogcmV2aWV3Lm5hbWUsXG4gICAgICAgICAgICAvLyAgJ3JhdGluZyc6IHJldmlldy5yYXRpbmcsXG4gICAgICAgICAgLy8gICAgJ2NvbW1lbnRzJzogcmV2aWV3LmNvbW1lbnRzLFxuICAgICAgICAgICAgLy8gICdjcmVhdGVkQXQnOiByZXZpZXcuY3JlYXRlZEF0XG4gICAgICAgICAgLy8gIH07XG5cbiAgICAgICAgICAgIGZldGNoKCdodHRwOi8vbG9jYWxob3N0OjEzMzcvcmV2aWV3cy8nLCB7XG4gICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXZpZXcpXG4gICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBzZWxmLnJldmlld3MucHVzaChyZXN1bHQpO1xuICAgICAgICAgICAgICAgIC8vIERCSGVscGVyLnVwZGF0ZVJldmlld3NEYihyZXN1bHQpO1xuICAgICAgICAgICAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAncmVzdGF1cmFudF9pZCc6IHJldmlldy5yZXN0YXVyYW50X2lkLFxuICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IHJldmlldy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAncmF0aW5nJzogcmV2aWV3LnJhdGluZyxcbiAgICAgICAgICAgICAgICAgICAgJ2NvbW1lbnRzJzogcmV2aWV3LmNvbW1lbnRzLFxuICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZEF0JzogcmV2aWV3LmNyZWF0ZWRBdCxcbiAgICAgICAgICAgICAgICAgICAgJ2lkJzogbnVtKzEwMFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBEQkhlbHBlci51cGRhdGVSZXZpZXdzRGIoZGF0YSk7XG4gICAgICAgICAgICAgIH0pLmNhdGNoKChlcikgPT4ge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVyLCBudWxsKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAvKlxuICAqIFNhdmluZyBvbiBSZXN0YXVyYW50ZGF0YWJhc2VcbiAgKi9cbiAgc3RhdGljIHNhdmVEYXRhYmFzZShkYXRhKSB7XG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24oZGIpIHtcbiAgICAgIGlmICghZGIpIHJldHVybjtcbiAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50RGInLCAncmVhZHdyaXRlJyk7XG4gICAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudERiJyk7XG4gICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24ocmVzdGF1cmFudCkge1xuICAgICAgICBzdG9yZS5wdXQocmVzdGF1cmFudCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcbiAgICB9KTtcbiAgfVxuXG5cbiAgLypcbiAgICogVXBkYXRlIGVudHJ5IG9uIFJlc3RhdXJhbnRkYXRhYmFzZSAhXG4gICAqL1xuXG4gIHN0YXRpYyB1cGRhdGVEYihpZCwgdmFsKSB7XG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oKGRiKSA9PiB7XG4gICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudERiJyk7XG4gICAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudERiJyk7XG4gICAgICByZXR1cm4gc3RvcmUuZ2V0KGlkLCAnaXNfZmF2b3JpdGUnKTtcbiAgICB9KS50aGVuKChvYmplY3QpID0+IHtcbiAgICAgICAvLyBJREIgdGVzdCBzZWFyY2ggb3V0cHV0XG4gICAgICAvLyBjb25zb2xlLmxvZyhvYmplY3QpO1xuICAgICAgb2JqZWN0LmlzX2Zhdm9yaXRlID0gdmFsO1xuICAgICAgREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbigoZGIpID0+IHtcbiAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnREYicsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnREYicpO1xuICAgICAgICBzdG9yZS5wdXQob2JqZWN0KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKlxuICAqIEdldHRpbmcgZGF0YSBmcm9tIERCLVJlc3RhdXJhbnRkYXRhYmFzZVxuICAqL1xuICBzdGF0aWMgZ2V0Q2FjaGVkRGIoKSB7XG4gICAgZGJwcm9taXNlID0gREJIZWxwZXIub3BlbkRhdGFiYXNlKCk7XG4gICAgcmV0dXJuIGRicHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRiKSB7XG4gICAgICBpZiAoIWRiKSByZXR1cm47XG4gICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudERiJyk7XG4gICAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudERiJyk7XG4gICAgICByZXR1cm4gc3RvcmUuZ2V0QWxsKCk7XG4gICAgfSk7XG4gIH1cblxuICAvKlxuICAgKiBzdGFnZTJcbiAgICovXG4gIHN0YXRpYyBmcm9tQXBpKCkge1xuICAgIHJldHVybiBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpXG4gICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgfSkudGhlbigocmVzdGF1cmFudHMpID0+IHtcbiAgICAgICAgREJIZWxwZXIuc2F2ZURhdGFiYXNlKHJlc3RhdXJhbnRzKTtcbiAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzO1xuICAgICAgfSk7XG4gIH1cblxuXG4gIC8qKlxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXG4gICAqL1xuXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XG4gICAgLyoqIHN0YWdlMVxuICAgICpsZXQgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgKnhoci5vcGVuKCdHRVQnLCBEQkhlbHBlci5EQVRBQkFTRV9VUkwpO1xuICAgICp4aHIub25sb2FkID0gKCkgPT4ge1xuICAgICogIGlmICh4aHIuc3RhdHVzID09PSAyMDApIHsgLy8gR290IGEgc3VjY2VzcyByZXNwb25zZSBmcm9tIHNlcnZlciFcbiAgICAqICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICogICAgY29uc3QgcmVzdGF1cmFudHMgPSBqc29uLnJlc3RhdXJhbnRzO1xuICAgICogICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xuICAgICogIH0gZWxzZSB7IC8vIE9vcHMhLiBHb3QgYW4gZXJyb3IgZnJvbSBzZXJ2ZXIuXG4gICAgKiAgICBjb25zdCBlcnJvciA9IChgUmVxdWVzdCBmYWlsZWQuIFJldHVybmVkIHN0YXR1cyBvZiAke3hoci5zdGF0dXN9YCk7XG4gICAgKiAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgKiAgfVxuICAgICp9O1xuICAgICp4aHIuc2VuZCgpO1xuICAgICoqL1xuXG4gICAvKiogVGVzdGluZyBmZXRjaCBmcm9tIGR1bW15IHNlcnZlclxuICAgICpmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpXG4gICAgKiAgLnRoZW4ocmVzcG9uZCA9PiB7XG4gICAgKiAgICBpZiAoIXJlc3BvbmQub2spe1xuICAgICogICAgICB0aHJvdyBcIlVuYWJsZSB0byBmZXRjaCBmcm9tIHNlcnZlciFcIjtcbiAgICAqICAgIH1cbiAgICAqICAgIHJldHVybiByZXNwb25kLmpzb24oKTtcbiAgICAqICB9KVxuICAgICogIC50aGVuKHJlc3RhdXJhbnRzID0+IGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKSlcbiAgICAqICAuY2F0Y2goZSA9PiBjYWxsYmFjayhlLG51bGwpKVxuICAgICoqL1xuXG4gICAgcmV0dXJuIERCSGVscGVyLmdldENhY2hlZERiKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChyZXN0YXVyYW50cy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN0YXVyYW50cyk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIERCSGVscGVyLmZyb21BcGkoKTtcbiAgICAgIH1cbiAgICB9KS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcikgPT4ge1xuICAgICAgICBjYWxsYmFjayhlciwgbnVsbCk7XG4gICAgICB9KTtcbiAgICB9XG5cblxuICAvKipcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cbiAgICovXG5cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVyLCByZXN0YXVyYW50cykgPT4ge1xuICAgIC8vICBpZiAoZXJyb3IpIHtcbiAgICAvLyAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgLy8gIH1cbiAgICAvLyAgZWxzZSB7XG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKChyKSA9PiByLmlkID09IGlkKTtcbiAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHsgLy8gR290IHRoZSByZXN0YXVyYW50XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7IC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXG4gICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIoKHIpID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG5cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9XG4gZWxzZSB7XG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIoKHIpID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH1cbiBlbHNlIHtcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoKHIpID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcigocikgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcbiAgICAgICAgfVxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG5cbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH1cbiBlbHNlIHtcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG4gICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZCk7XG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cblxuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpO1xuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogIEZldGNoIGFsbCByZXZpZXdzXG4gICAqL1xuXG4gICBzdGF0aWMgZmV0Y2hSZXZpZXcoY2FsbGJhY2spIHtcbiAgICByZXR1cm4gZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzJylcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICB9KS50aGVuKChyZXZpZXdzKSA9PiB7XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmV2aWV3cyk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXIpID0+IHtcbiAgICAgICAgICBjYWxsYmFjayhlciwgbnVsbCk7XG4gICAgICAgIH0pO1xuICAgfVxuXG4gICAvKipcbiAgICAqIEZldGNoIHJldmlldyBieSByZXN0YXVyYW50IGlkXG4gICAgKi9cbi8qXG4gKiBXaXRob3V0IENhY2hlZCAhXG4gKlxuICogICAgc3RhdGljIGZldGNoUmV2aWV3QnlJZChpZCwgY2FsbGJhY2spIHtcbiAqICAgICAgcmV0dXJuIGZldGNoKCdodHRwOi8vbG9jYWxob3N0OjEzMzcvcmV2aWV3cy8/cmVzdGF1cmFudF9pZD0nKyBpZClcbiAqICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICogICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gKiAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oKVxuICogICAgICAgICAgICAudGhlbigoanNvbikgPT4ge1xuICogICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGpzb24pO1xuICogICAgICAgICAgICAgIHJldHVyblxuICogICAgICAgICAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHtcbiAqICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcbiAqICAgICAgICAgICAgfSk7XG4gKiAgICAgICAgICB9IGVsc2Uge1xuICogICAgICAgICAgICBjYWxsYmFjaygoYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHtyZXNwb25zZS5zdGF0dXN9YCksIG51bGwpO1xuICogICAgICAgICAgfVxuICogICAgICAgIH1cbiAqICAgICAgKS5jYXRjaCgoZXJyb3IpID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG4gKiAgICB9XG4gKi9cbiAgICBzdGF0aWMgZmV0Y2hSZXZpZXdCeUlkKGlkLCBjYWxsYmFjaykge1xuICAgICAgcmV0dXJuIERCSGVscGVyLnJldmlld3NHZXRDYWNoZWQoaWQpLnRoZW4oKHJldmlld3MpID0+IHtcbiAgICAgICAgaWYgKHJldmlld3MubGVuZ3RoPjEpIHtcbiAgICAgICAgICAvLyBsZXQgZGF0YSA9IHJldmlld3MuZmlsdGVyKChyKSA9PiByLnJlc3RhdXJhbnRfaWQgPT0gc2VsZi5yZXN0YXVyYW50LmlkKTtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJldmlld3MpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jldmlld3MvP3Jlc3RhdXJhbnRfaWQ9JysgaWQpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgfSkudGhlbigocmV2aWV3cykgPT4ge1xuICAgICAgICAgICAgICBEQkhlbHBlci5zYXZlUmV2aWV3c0RhdGFiYXNlKHJldmlld3MpO1xuICAgICAgICAgICAgICByZXR1cm4gcmV2aWV3cztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KS50aGVuKChyZXZpZXdzKSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpO1xuICAgICAgICByZXR1cm5cbiAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9KTtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIFBvc3QgUmV2aWV3c1xuICAgKi9cblxuICAgc3RhdGljIHBvc3RSZXZpZXdzKHJldmlldykge1xuICAgICByZXR1cm4gZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzLycsIHttZXRob2Q6ICdQT1NUJywgYm9keTogcmV2aWV3fSlcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIFt7fV07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgfVxuXG4gICAvKlxuICAgICogTWFyayBGYXZvcml0ZSBSZXN0YXVyYW50c1xuICAgICovXG4gICAgc3RhdGljIG1hcmtGYXZvcml0ZShyZXN0YXVyYW50KSB7XG4gICAgICBsZXQgbWFyayA9ICcnO1xuICAgICAgaWYgKHNlbGYucmVzdGF1cmFudC5pc19mYXZvcml0ZT09PSd0cnVlJykge1xuICAgICAgICBtYXJrID0gYGh0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXN0YXVyYW50cy8ke3Jlc3RhdXJhbnR9Lz9pc19mYXZvcml0ZT10cnVlYDtcbiAgICAgICAgY29uc29sZS5sb2cobWFyayk7XG4gICAgICB9IGVsc2UgaWYgKHNlbGYucmVzdGF1cmFudC5pc19mYXZvcml0ZT09PSdmYWxzZScpIHtcbiAgICAgICAgbWFyayA9IGBodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHMvJHtyZXN0YXVyYW50fS8/aXNfZmF2b3JpdGU9ZmFsc2VgO1xuICAgICAgICBjb25zb2xlLmxvZyhtYXJrKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZldGNoKG1hcmssIHttZXRob2Q6ICdQVVQnfSlcbiAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgIHJldHVybiBbe31dO1xuICAgICAgICAgICB9XG4gICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gIC8qKlxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxuICAgKi9cblxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxuICAgKi9cblxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICAvLyByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofWBcbi8qXG4gICAgICAgIGlmIChNb2Rlcm5penIud2VicCkge1xuICAgICAgICAgIC8vIHN1cHBvcnRlZFxuICAgICAgICAgIHJldHVybiAoYC9kaXN0L2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH0ud2VicGApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIG5vdC1zdXBwb3J0ZWRcbiAgICAgICAgICByZXR1cm4gKGAvZGlzdC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LmpwZ2ApO1xuICAgICAgICB9XG4gICAgICAgICovXG4gICAgICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LndlYnBgKTtcbiAgICB9XG5cblxuICAvKipcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxuICAgKi9cblxuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXG4gICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXG4gICAgICBtYXA6IG1hcCxcbiAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1B9XG4gICAgKTtcbiAgICByZXR1cm4gbWFya2VyO1xuICB9XG59XG4iLCIvKiBlc2xpbnQgbWF4LWxlbjogW1wiZXJyb3JcIiwgeyBcImNvZGVcIjogMjAwIH1dKi9cbi8qIGVzbGludCBuby11bnVzZWQtdmFyczogW1wiZXJyb3JcIiwgeyBcInZhcnNcIjogXCJsb2NhbFwiIH1dKi9cblxuXG5sZXQgcmVzdGF1cmFudDtcbmxldCBtYXA7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxuICovXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICAgICAgem9vbTogMTYsXG4gICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXG4gICAgICAgIHNjcm9sbHdoZWVsOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLnNldEF0dHJpYnV0ZSgncm9sZScsICdhcHBsaWNhdGlvbicpO1xuXG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xuXG4gICAgICAvKlxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLnNldEF0dHJpYnV0ZSgncm9sZScsJ2FwcGxpY2F0aW9uJyk7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJykuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsJzQnKTtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKS5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywndHJ1ZScpO1xuICAgICAgKi9cbiAgICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm1hcCk7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5cbmZldGNoUmVzdGF1cmFudEZyb21VUkwgPSAoY2FsbGJhY2spID0+IHtcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcbiAgICBjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCc7XG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICB9IGVsc2Uge1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcbiAgICAgIGlmICghcmVzdGF1cmFudCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcbiAgICB9KTtcbiAgfVxufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xuXG5maWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBzZWxmLmlzX2Zhdm9yaXRlID0gcmVzdGF1cmFudC5pc19mYXZvcml0ZTtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG4gIGlmIChyZXN0YXVyYW50LmlzX2Zhdm9yaXRlPT09J3RydWUnKSB7XG4gIG5hbWUuaW5uZXJIVE1MKz1gPGJ1dHRvbiB0YWJpbmRleD1cIjBcIiBhcmlhLWxhYmVsPVwiTWFyayBhcyB1bmZhdm9yaXRlIHBsYWNlXCIgb25jbGljaz1cImZhdkJ1dHRvbih0aGlzKVwiIGNsYXNzPVwiZmF2b3JpdGVcIj48L2J1dHRvbj5gO1xuICB9IGVsc2Uge1xuICAgIG5hbWUuaW5uZXJIVE1MKz1gPGJ1dHRvbiB0YWJpbmRleD1cIjBcIiBhcmlhLWxhYmVsPVwiTWFyayBhcyBmYXZvcml0ZSBwbGFjZVwiIG9uY2xpY2s9XCJmYXZCdXR0b24odGhpcylcIiBjbGFzcz1cInVuX2Zhdm9yaXRlXCI+PC9idXR0b24+YDtcbiAgfVxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcblxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICAvKiB1bmlxdWUgYWx0LWFyaWFsYWJlbCAqL1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBuYW1lLmlubmVySFRNTCsnIHJlc3RhdXJhbnQnKTtcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdhbHQnLCBuYW1lLmlubmVySFRNTCsnIHJlc3RhdXJhbnQnKTtcblxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuICB9XG4gIC8vIGZpbGwgcmV2aWV3c1xuICBEQkhlbHBlci5wcm9jZXNzQWxsUGVuZGluZ1Jldmlld3MoKTtcbiAgREJIZWxwZXIuY2xlYXJPdXRib3goKTtcbiAgZmV0Y2hSZXZpZXdVcmwoKTtcbiAgLypcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG4gIGNvbnN0IGFkZFJldmlld0J1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICBhZGRSZXZpZXdCdXR0b24uaW5uZXJIVE1MKCdBZGQgUmV2aWV3Jyk7XG4gIGFkZFJldmlld0J1dHRvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XG4gIGFkZFJldmlld0J1dHRvbi5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2FkZFJldmlld0J1dHRvbicpO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQoYWRkUmV2aWV3QnV0dG9uKTtcbiAgKi9cbn07XG5cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5cbmZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycykgPT4ge1xuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgZGF5LnN0eWxlLmNvbG9yPScjNTI1MjUyJztcbiAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcblxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcbiAgICB0aW1lLnN0eWxlLmNvbG9yPScjNTI1MjUyJztcblxuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gIH1cbn07XG5cbi8qKlxuICogRmF2b3JpdGUgUmVzdGF1cmFudCBidXR0b25cbiAqL1xuXG4gZmF2QnV0dG9uID0gKGVsZW1lbnQpID0+IHtcbiAgIGlmIChzZWxmLmlzX2Zhdm9yaXRlID09PSAndHJ1ZScpIHtcbiAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdmYXZvcml0ZScpO1xuICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3VuX2Zhdm9yaXRlJyk7XG4gICAgIHNlbGYucmVzdGF1cmFudC5pc19mYXZvcml0ZT0nZmFsc2UnO1xuICAgICBzZWxmLmlzX2Zhdm9yaXRlPSdmYWxzZSc7XG4gICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ01hcmsgYXMgZmF2b3JpdGUnKTtcbiAgICAgLy8gREJIZWxwZXIubWFya0Zhdm9yaXRlKHNlbGYucmVzdGF1cmFudC5pZCk7XG4gICB9IGVsc2Uge1xuICAgICBzZWxmLnJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSAndHJ1ZSc7XG4gICAgIHNlbGYuaXNfZmF2b3JpdGUgPSAndHJ1ZSc7XG4gICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ01hcmsgYXMgdW5mYXZvcml0ZScpO1xuICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3VuX2Zhdm9yaXRlJyk7XG4gICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZmF2b3JpdGUnKTtcbiAgICAvLyAgREJIZWxwZXIubWFya0Zhdm9yaXRlKHNlbGYucmVzdGF1cmFudC5pZCk7XG4gICB9XG4gICBEQkhlbHBlci5tYXJrRmF2b3JpdGUoc2VsZi5yZXN0YXVyYW50LmlkKTtcbiAgIHJldHVybiBEQkhlbHBlci51cGRhdGVEYihzZWxmLnJlc3RhdXJhbnQuaWQsIHNlbGYucmVzdGF1cmFudC5pc19mYXZvcml0ZSk7XG4gfTtcblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cblxuIGZldGNoUmV2aWV3VXJsID0gKCkgPT4ge1xuICBpZiAoc2VsZi5yZXZpZXcpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG4gICAgLy8gY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KVxuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuXG5cbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCdcbiAgICAvLyBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gIH0gZWxzZSB7XG4gICAgREJIZWxwZXIuZmV0Y2hSZXZpZXdCeUlkKGlkLCAoZXJyb3IsIHJldmlld3MpID0+IHtcblxuICAgICAgc2VsZi5yZXZpZXdzID0gcmV2aWV3cztcblxuICAgICAgaWYgKCFyZXZpZXdzKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICBmaWxsUmV2aWV3c0hUTUwobnVsbCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGZpbGxSZXZpZXdzSFRNTCgpO1xuICAgIH0pXG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgQWRkIFJldmlldyBCdXR0b24gd2l0aCBzdHlsZSBzZXR0aW5nc1xuICovXG5cbmFkZFJldmlld0J1dHRvbiA9ICgpID0+IHtcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG4gIGNvbnN0IGFkZFJldmlld0J1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICBjb25zdCBhZGRSZXZpZXdCdXR0b24yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuXG4gIGFkZFJldmlld0J1dHRvbjIuaW5uZXJIVE1MID0nQWRkIFJldmlldyc7XG4gIGFkZFJldmlld0J1dHRvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XG4gIGFkZFJldmlld0J1dHRvbi5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2FkZFJldmlld0J1dHRvbicpO1xuICBhZGRSZXZpZXdCdXR0b24uc2V0QXR0cmlidXRlKCdvbmNsaWNrJywgJ3Jldmlld0Zvcm0oKScpO1xuICBhZGRSZXZpZXdCdXR0b24yLnN0eWxlLmNvbG9yID0gJyNmZmYnO1xuICBhZGRSZXZpZXdCdXR0b24uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyM4NTQ0MDAnO1xuICBhZGRSZXZpZXdCdXR0b24uc3R5bGUuaGVpZ2h0ID0gJzM1cHgnO1xuICBhZGRSZXZpZXdCdXR0b24uc3R5bGUud2lkdGggPSAnMTAwcHgnO1xuICBhZGRSZXZpZXdCdXR0b24uc3R5bGUubWFyZ2luID0gJzEwcHgnO1xuICBhZGRSZXZpZXdCdXR0b24uc3R5bGUucGFkZGluZyA9ICcxMHB4JztcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKGFkZFJldmlld0J1dHRvbik7XG4gIC8vIGFjdGl2YXRlIHN0YXRlIHNldHRpbmdcbiAgYWRkUmV2aWV3QnV0dG9uLmRpc2FibGUgPSBmYWxzZTtcbiAgYWRkUmV2aWV3QnV0dG9uLmhpZGRlbiA9IGZhbHNlO1xuICAvLyBib29rbWFyayBzZXR0aW5nIVxuICBhZGRSZXZpZXdCdXR0b24yLnNldEF0dHJpYnV0ZSgnaHJlZicsICcjcmV2aWV3Rm9ybScpO1xuICBhZGRSZXZpZXdCdXR0b24uYXBwZW5kQ2hpbGQoYWRkUmV2aWV3QnV0dG9uMik7XG59XG5cbnJldmlld0Zvcm0gPSAoKSA9PiB7XG4gIGNvbnN0IGFkZFJldmlld0J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRSZXZpZXdCdXR0b24nKTtcbiAgLy8gZGUtYWN0aXZhdGUgc3RhdGUgc2V0dGluZ1xuICBhZGRSZXZpZXdCdXR0b24uZGlzYWJsZSA9IHRydWU7XG4gIGFkZFJldmlld0J1dHRvbi5oaWRkZW4gPSB0cnVlO1xuICAvLyBDcmVhdGUgdGhlIFJldmlldyBGb3JtIHdpdGggc2V0dGluZ3NcbiAgY29uc3QgcmV2aWV3Rm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTtcbiAgcmV2aWV3Rm9ybS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3Jldmlld19mb3JtJyk7XG4gIHJldmlld0Zvcm0uaWQgPSAncmV2aWV3Rm9ybSc7XG4gIHJldmlld0Zvcm0uc2V0QXR0cmlidXRlKCdyb2xlJywgJ2Zvcm0nKTtcbiAgcmV2aWV3Rm9ybS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzE0Jyk7XG4gIHJldmlld0Zvcm0uc2V0QXR0cmlidXRlKCdvcmRlcicsICcwJyk7XG4gIGNvbnN0IHJldmlld3NsaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzbGlzdC5zZXRBdHRyaWJ1dGUoJ29yZGVyJywgJzEnKTtcbiAgY29uc3QgcmV2aWV3SGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcbiAgcmV2aWV3SGVhZGVyLmlubmVySFRNTCA9ICdSZXZpZXcgRm9ybSBmb3InO1xuICByZXZpZXdIZWFkZXIuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2gyJyk7XG4gIHJldmlld0hlYWRlci5pZCA9ICdyZXZpZXdIZWFkZXInO1xuICBjb25zdCByZXZpZXdSZXN0YXVyYW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDMnKTtcbiAgcmV2aWV3UmVzdGF1cmFudC5pbm5lckhUTUwgPSBzZWxmLnJlc3RhdXJhbnQubmFtZTtcbiAgcmV2aWV3UmVzdGF1cmFudC5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnaDMnKTtcbiAgcmV2aWV3UmVzdGF1cmFudC5pZCA9ICdyZXZpZXdSZXN0YXVyYW50JztcbiAgY29uc3QgcmV2aWV3TmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIHJldmlld05hbWUuaW5uZXJIVE1MID0gJ05hbWU6JztcbiAgcmV2aWV3TmFtZS5zZXRBdHRyaWJ1dGUoJ2ZvcicsICduYW1lJyk7XG4gIHJldmlld05hbWUuaWQgPSAncmV2aWV3TmFtZSc7XG4gIHJldmlld05hbWUuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2xhYmVsJyk7XG4gIGNvbnN0IHJldmlld0lucHV0TmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIHJldmlld0lucHV0TmFtZS5pZCA9ICdyZXZpZXdJbnB1dE5hbWUnO1xuICByZXZpZXdJbnB1dE5hbWUuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2lucHV0Jyk7XG4gIHJldmlld0lucHV0TmFtZS5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnbmFtZScpO1xuICByZXZpZXdJbnB1dE5hbWUuc2V0QXR0cmlidXRlKCdwbGFjZWhvbGRlcicsICdFbnRlciB5b3VyIE5hbWUuLicpO1xuICByZXZpZXdJbnB1dE5hbWUuc2V0QXR0cmlidXRlKCdyZXF1aXJlZCcsICd0cnVlJyk7XG4gIGNvbnN0IHJldmlld1JhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIHJldmlld1JhdGluZy5pZCA9ICdyZXZpZXdSYXRpbmcnO1xuICByZXZpZXdSYXRpbmcuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2xhYmVsJyk7XG4gIHJldmlld1JhdGluZy5zZXRBdHRyaWJ1dGUoJ2ZvcicsICdyYXRpbmcnKTtcbiAgcmV2aWV3UmF0aW5nLmlubmVySFRNTCA9ICdSYXRpbmc6JztcbiAgcmV2aWV3UmF0aW5nLm1pbiA9ICcxJztcbiAgcmV2aWV3UmF0aW5nLm1heCA9ICc1JztcbiAgY29uc3QgcmV2aWV3SW5wdXRSYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICByZXZpZXdJbnB1dFJhdGluZy5pZCA9ICdyZXZpZXdJbnB1dFJhdGluZyc7XG4gIHJldmlld0lucHV0UmF0aW5nLnNldEF0dHJpYnV0ZSgnbmFtZScsICdyYXRpbmcnKTtcbiAgcmV2aWV3SW5wdXRSYXRpbmcuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2lucHV0Jyk7XG4gIHJldmlld0lucHV0UmF0aW5nLnNldEF0dHJpYnV0ZSgncGxhY2Vob2xkZXInLCAnRW50ZXIgeW91ciBSYXRpbmcuLiBGcm9tIDEgdG8gNS4nKTtcbiAgcmV2aWV3SW5wdXRSYXRpbmcuc2V0QXR0cmlidXRlKCdyZXF1aXJlZCcsICd0cnVlJyk7XG4gIGNvbnN0IHJldmlld0NvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgcmV2aWV3Q29tbWVudHMuaWQgPSAncmV2aWV3Q29tbWVudHMnO1xuICByZXZpZXdDb21tZW50cy5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnbGFiZWwnKTtcbiAgcmV2aWV3Q29tbWVudHMuc2V0QXR0cmlidXRlKCdmb3InLCAnY29tbWVudHMnKTtcbiAgcmV2aWV3Q29tbWVudHMuaW5uZXJIVE1MID0gJ0NvbW1lbnRzOic7XG4gIGNvbnN0IHJldmlld0lucHV0Q29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpO1xuICByZXZpZXdJbnB1dENvbW1lbnRzLmlkID0gJ3Jldmlld0lucHV0Q29tbWVudHMnO1xuICByZXZpZXdJbnB1dENvbW1lbnRzLnNldEF0dHJpYnV0ZSgncm9sZScsICdpbnB1dCcpO1xuICByZXZpZXdJbnB1dENvbW1lbnRzLnNldEF0dHJpYnV0ZSgnbmFtZScsICdjb21tZW50cycpO1xuICByZXZpZXdJbnB1dENvbW1lbnRzLnNldEF0dHJpYnV0ZSgncGxhY2Vob2xkZXInLCAnRW50ZXIgeW91ciBDb21tZW50cyBoZXJlLi4gTWluaW11bSA5MCBjaGFyYWN0ZXJzIScpO1xuICByZXZpZXdJbnB1dENvbW1lbnRzLnNldEF0dHJpYnV0ZSgncmVxdWlyZWQnLCAndHJ1ZScpO1xuICBjb25zdCByZXZpZXdTdWJtaXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgcmV2aWV3U3VibWl0LmlkID0gJ3Jldmlld1N1Ym1pdCc7XG4gIHJldmlld1N1Ym1pdC5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYnV0dG9uJyk7XG4gIHJldmlld1N1Ym1pdC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnYnV0dG9uJyk7XG4gIHJldmlld1N1Ym1pdC5pbm5lckhUTUwgPSAnU3VibWl0JztcbiAgcmV2aWV3U3VibWl0LnNldEF0dHJpYnV0ZSgnb25jbGljaycsICdhZGRSZXZpZXcoKScpO1xuICAvLyBDb25uZWN0IHRoZSBFbGVtZW50IHdpdGggY2hpbGRzXG4gIGFkZENoaWxkSW50b0VsZW1lbnQocmV2aWV3Rm9ybSwgW3Jldmlld0hlYWRlciwgcmV2aWV3UmVzdGF1cmFudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZpZXdOYW1lLCByZXZpZXdJbnB1dE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2aWV3UmF0aW5nLCByZXZpZXdJbnB1dFJhdGluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZpZXdDb21tZW50cywgcmV2aWV3SW5wdXRDb21tZW50cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZpZXdTdWJtaXRdKTtcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZChyZXZpZXdGb3JtKTtcbiAgLyoqXG4gICAqIEZvcm0gU3R5bGVzXG4gICAqL1xuICByZXZpZXdGb3JtLnN0eWxlLmhlaWdodCA9ICc0MDBweCc7XG4gIHJldmlld0Zvcm0uc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgcmV2aWV3Rm9ybS5zdHlsZS5mbGV4RGlyZWN0aW9uID0gJ2NvbHVtbic7XG4gIHJldmlld0lucHV0UmF0aW5nLnN0eWxlLndpZHRoID0gJzE1MHB4JztcbiAgcmV2aWV3SW5wdXRSYXRpbmcuc3R5bGUubWFyZ2luQm90dG9tID0gJzVweCc7XG4gIHJldmlld0lucHV0TmFtZS5zdHlsZS53aWR0aCA9ICcxNTBweCc7XG4gIHJldmlld0lucHV0TmFtZS5zdHlsZS5tYXJnaW5Cb3R0b20gPSAnNXB4JztcbiAgcmV2aWV3SW5wdXRDb21tZW50cy5zdHlsZS5oZWlnaHQgPSAnMTAwcHgnO1xuICByZXZpZXdJbnB1dENvbW1lbnRzLnN0eWxlLndpZHRoID0gJzkwJSc7XG4gIHJldmlld0lucHV0Q29tbWVudHMuc3R5bGUubWFyZ2luQm90dG9tID0gJzVweCc7XG4gIHJldmlld1N1Ym1pdC5zdHlsZS53aWR0aCA9ICcxMDBweCc7XG4gIHJldmlld0hlYWRlci5zdHlsZS5tYXJnaW5Cb3R0b20gPSAnMTBweCc7XG4gIHJldmlld1Jlc3RhdXJhbnQuc3R5bGUubWFyZ2luQm90dG9tID0gJzVweCc7XG59XG5cbi8qKlxuICogRm9ybSBWYWxpZGF0aW9uIHdpdGggdGhlIGNvbW1lbnQgbGltaXRhdGlvbiFcbiAqL1xuXG5jaGVja1ZhbGlkYXRpb24gPSAoY2hlY2tsaXN0KSA9PiB7XG4gIGxldCB2YWxpZCA9IHRydWU7XG5cbiAgaWYgKGNoZWNrbGlzdFswXSA9PT0nJyB8fCAoY2hlY2tsaXN0WzFdIDwxIHx8IGNoZWNrbGlzdFsxXSA+NSB8fCBjaGVja2xpc3RbMV0gPT09JycpIHx8IChjaGVja2xpc3RbMl0gPT09JycgfHwgY2hlY2tsaXN0WzNdIDw9IDkwKSkge1xuICAgIHZhbGlkID0gZmFsc2U7XG4gICAgbGV0IGVycm9yTWVzc2FnZSA9ICdFcnJvciEgUGxlYXNlIGZpbGwgdGhlIGVtcHR5IGZpZWxkLCBvciBmaXggdGhlIHRoZSBpbnZhbGlkIGlucHV0IVxcbktlZXAgaW4gbWluZCB0aGUgbWluaW11bSBjaGFyYWN0ZXJzIGZvciB0aGUgY29tbWVudCBhcmUgOTAhISEnO1xuICAgIGNvbnNvbGUubG9nKGVycm9yTWVzc2FnZSk7XG4gICAgYWxlcnQoZXJyb3JNZXNzYWdlKTtcbiAgfVxuICByZXR1cm4gdmFsaWQ7XG59XG5cbi8qKlxuICogQ2hlY2ssIFBvc3QsIFJlZnJlc2ghIVxuICovXG5cbmFkZFJldmlldyA9ICgpID0+IHtcbiAgbGV0IHJldmlld0lucHV0TmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdGb3JtJylbMF07XG4gIGxldCByZXZpZXdJbnB1dFJhdGluZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdGb3JtJylbMV07XG4gIGxldCByZXZpZXdJbnB1dENvbW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld0Zvcm0nKVsyXTtcbiAgY29uc3QgcmV2aWV3ID0ge1xuICAgICdyZXN0YXVyYW50X2lkJzogc2VsZi5yZXN0YXVyYW50LmlkLFxuICAgICduYW1lJzogcmV2aWV3SW5wdXROYW1lLnZhbHVlLFxuICAgICdyYXRpbmcnOiByZXZpZXdJbnB1dFJhdGluZy52YWx1ZSxcbiAgICAnY29tbWVudHMnOiByZXZpZXdJbnB1dENvbW1lbnRzLnZhbHVlLFxuICAgICdjcmVhdGVkQXQnOiBEYXRlLm5vdygpXG4gIH07XG4gIGxpc3RhPVtyZXZpZXdJbnB1dE5hbWUudmFsdWUsXG4gICAgICAgIHJldmlld0lucHV0UmF0aW5nLnZhbHVlLFxuICAgICAgICByZXZpZXdJbnB1dENvbW1lbnRzLnZhbHVlLFxuICAgICAgICByZXZpZXdJbnB1dENvbW1lbnRzLnRleHRMZW5ndGhdO1xuICBpZiAoY2hlY2tWYWxpZGF0aW9uKGxpc3RhKSkge1xuICAgIGlmIChuYXZpZ2F0b3Iub25MaW5lKSB7XG4gICAgREJIZWxwZXIucG9zdFJldmlld3MoSlNPTi5zdHJpbmdpZnkocmV2aWV3KSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICBzZWxmLnJldmlld3MucHVzaChyZXN1bHQpO1xuICAgICAgLy8gZmlsbFJldmlld3NIVE1MKCk7XG4gICAgICBEQkhlbHBlci51cGRhdGVSZXZpZXdzRGIocmVzdWx0KTtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICBhbGVydCgnU3RhdHVzIG9mIFN1Ym1pdGVkIFJldmlldzogU3VjY2VzcyEnKTtcbiAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBzZWxmLnJldmlld3MucHVzaChyZXZpZXcpO1xuICAgIC8vICBmaWxsUmV2aWV3c0hUTUwoKTtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgIH0sIDEwMDApO1xuICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoIW5hdmlnYXRvci5vbkxpbmUpIHtcbiAgICAgICAgREJIZWxwZXIuc2F2ZU91dGJveERhdGFiYXNlKHJldmlldyk7XG4gICAgICAgIC8vYWxlcnQoJ1dhcm5pbmchISEhXFxuWW91IGFyZSBvZmZsaW5lLCB5b3VyIHJldmlldyBpcyBzYXZlZCBvbiBvdXRib3ghXFxuWW91ciByZXZpZXcgd2lsbCBiZSBhdXRvLXN1Ym1pdGVkIHdoZW4geW91IHdpbGwgYmUgb25saW5lIGFnYWluIScpO1xuICAgICAgICAvL3NldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgLy8gICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgLy99LCAxMDAwKTtcbiAgICAgICBsZXQgcmV2Rm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdGb3JtJyk7XG4gICAgICAgcmV2Rm9ybS5yZXNldCgpO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIENvbm5lY3Rpb24gQ29uc3RydWN0b3IgYXBwZW5kQ2hpbGRcbiAqL1xuXG5hZGRDaGlsZEludG9FbGVtZW50ID0gKGVsZW1lbnQsIGNoaWxkcmVuKSA9PiB7XG4gIGNoaWxkcmVuLmZvckVhY2goKGNoaWxkKSA9PiB7XG4gICAgZWxlbWVudC5hcHBlbmRDaGlsZChjaGlsZCk7XG4gIH0pO1xufVxuXG5maWxsUmV2aWV3c0hUTUwgPSAocmV2aWV3cyA9IHNlbGYucmV2aWV3cykgPT4ge1xuICAvKlxuICBpZiAoIXJldmlld3MpIHtcbiAgREJIZWxwZXIuZmV0Y2hSZXZpZXdCeUlkKHNlbGYucmVzdGF1cmFudC5pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgIHNlbGYucmV2aWV3cyA9cmVzcG9uc2U7XG4gICAgZmlsbFJldmlld3NIVE1MKCk7XG4gIH0pO1xufSAqL1xuICAvLyBsZXQgZHVwbGljYXRlSXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoMicpWzFdO1xuICAvLyBsZXQgZHVwbGljYXRlSXRlbTIgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgncCcpWzNdO1xuXG4vLyAgaWYgKGR1cGxpY2F0ZUl0ZW0pIHtcbi8vICAgIGR1cGxpY2F0ZUl0ZW0ucmVtb3ZlKCk7XG4gICAgLy8gZHVwbGljYXRlSXRlbTIucmVtb3ZlKCk7XG4vLyAgfVxuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcbiAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xuICB0aXRsZS5pbm5lckhUTUwgPSAnUmV2aWV3cyc7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aXRsZSk7XG4gIC8vIEFkZCBSZXZpZXcgYnV0dG9uICFcbiAgYWRkUmV2aWV3QnV0dG9uKCk7XG4gIGlmICghcmV2aWV3cykge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzLmZvckVhY2goKHJldmlldykgPT4ge1xuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG4gIH0pO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuXG5jcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIC8qIHNjcmVlbmVyIHNldHRpbmdzICovXG4gIGxpLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMTMnKTtcbiAgbGkuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2xpc3RpdGVtJyk7XG4gIC8qIG5hbWUgc2V0dGluZ3MgKi9cbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcbiAgbmFtZS5zdHlsZS50ZXh0QWxpZ249J2xlZnQnO1xuICBuYW1lLnN0eWxlLndpZHRoPSc1MCUnO1xuICBuYW1lLnN0eWxlLm9yZGVyPScwJztcbiAgbmFtZS5zdHlsZS5mb250V2VpZ2h0PSdib2xkJztcbiAgbmFtZS5zdHlsZS5mb250U2l6ZT0nMTZweCc7XG4gIG5hbWUuc3R5bGUuY29sb3I9JyM5MzJDMkEnO1xuXG5cbiAgbGkuYXBwZW5kQ2hpbGQobmFtZSk7XG4gIC8qIGRhdGUgc2V0dGluZ3MgKi9cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSBuZXcgRGF0ZShyZXZpZXcuY3JlYXRlZEF0KS50b0dNVFN0cmluZygpO1xuICBkYXRlLnN0eWxlLnRleHRBbGlnbj0ncmlnaHQnO1xuICBkYXRlLnN0eWxlLndpZHRoPSc1MCUnO1xuICBkYXRlLnN0eWxlLmZvbnRTaXplPScxNnB4JztcbiAgZGF0ZS5zdHlsZS5mb250U3R5bGU9J29ibGlxdWUnO1xuICBkYXRlLnN0eWxlLnRleHREZWNvcmF0aW9uPSd1bmRlcmxpbmUnO1xuICBkYXRlLnN0eWxlLm9yZGVyPScwJztcblxuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgLyogUmF0aW5nIHNldHRpbmdzICovXG4gIHJhdGluZy5zdHlsZS5iYWNrZ3JvdW5kQ29sb3I9JyMzMzMzMzMnO1xuICByYXRpbmcuc3R5bGUuYm9yZGVyUmFkaXVzPSc1cHggNXB4JztcbiAgcmF0aW5nLnN0eWxlLnRleHRBbGlnbj0nY2VudGVyJztcbiAgcmF0aW5nLnN0eWxlLmZvbnRXZWlnaHQ9J2JvbGQnO1xuICByYXRpbmcuc3R5bGUuZm9udFNpemU9JzE3cHgnO1xuICByYXRpbmcuc3R5bGUuaGVpZ2h0PScyNXB4JztcbiAgcmF0aW5nLnN0eWxlLndpZHRoPScxMDBweCc7XG4gIHJhdGluZy5zdHlsZS5jb2xvcj0nI0ZGQjUyRSc7XG4gIHJhdGluZy5zdHlsZS5vcmRlcj0nMSc7XG5cbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcbiAgLyogY29tbWVudCBzZXR0aW5ncyAqL1xuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBjb21tZW50cy5zdHlsZS5vcmRlcj0nMic7XG4gIGNvbW1lbnRzLnN0eWxlLmxpbmVIZWlnaHQ9JzEuNic7XG4gIGNvbW1lbnRzLnN0eWxlLnRleHRBbGlnbj0nanVzdGlmeSc7XG5cbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG5cbiAgcmV0dXJuIGxpO1xufTtcblxuLyoqXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxuICovXG5cbmZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQ9c2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59O1xuXG4vKipcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXG4gKi9cblxuZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xuICBpZiAoIXVybCkge1xudXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG59XG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcbiAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCk7XG4gIGNvbnN0IHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gIGlmICghcmVzdWx0cykge1xucmV0dXJuIG51bGw7XG59XG4gIGlmICghcmVzdWx0c1syXSkge1xucmV0dXJuICcnO1xufVxuICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csICcgJykpO1xufTtcbiJdLCJmaWxlIjoicmVzdGF1cmFudC1taW4uanMifQ==
