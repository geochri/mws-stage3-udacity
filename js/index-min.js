let dbpromise,num,restaurants,neighborhoods,cuisines;class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static openDatabase(){return idb.open("restaurantDb",1,function(e){e.createObjectStore("restaurantDb",{keyPath:"id"})})}static openReviewDatabase(){return idb.open("reviewsDb",1,function(e){e.createObjectStore("reviewsDb",{keyPath:"id"}).createIndex("restaurant_id","restaurant_id")})}static saveReviewsDatabase(e){return DBHelper.openReviewDatabase().then(t=>{if(!t)return;let r=t.transaction("reviewsDb","readwrite"),a=r.objectStore("reviewsDb");return e.forEach(e=>{a.put(e)}),r.complete})}static reviewsGetCached(e){return(dbpromise=DBHelper.openReviewDatabase()).then(e=>{if(!e)return;return e.transaction("reviewsDb").objectStore("reviewsDb").getAll()}).then(t=>(num=t.filter(t=>t.restaurant_id==parseInt(e)).length,t.filter(t=>t.restaurant_id==parseInt(e)))).catch(e=>console.log(e))}static updateReviewsDb(e){return DBHelper.openReviewDatabase().then(t=>{return t.transaction("reviewsDb","readwrite").objectStore("reviewsDb").add(e)})}static openOutboxDatabase(){return idb.open("outbox",1,function(e){e.createObjectStore("outbox",{keyPath:"createdAt"})})}static saveOutboxDatabase(e){return DBHelper.openOutboxDatabase().then(t=>{if(!t)return;let r=t.transaction("outbox","readwrite");return r.objectStore("outbox").put(e),r.complete})}static pendingForSubmitReviews(e){navigator.onLine&&e.length>0&&e.forEach(e=>{fetch("http://localhost:1337/reviews/",{method:"POST",body:JSON.stringify(e)}).then(clearOutbox())})}static clearOutbox(){if(navigator.onLine)return DBHelper.openOutboxDatabase().then(e=>{let t=e.transaction("outbox","readwrite");return t.objectStore("outbox").clear(),t.complete})}static processAllPendingReviews(){if(navigator.onLine)return DBHelper.openOutboxDatabase().then(e=>{return e.transaction("outbox").objectStore("outbox").getAll()}).then(e=>{e.forEach(function(e){fetch("http://localhost:1337/reviews/",{method:"POST",body:JSON.stringify(e)}).then(t=>{self.reviews.push(t);let r={restaurant_id:e.restaurant_id,name:e.name,rating:e.rating,comments:e.comments,createdAt:e.createdAt,id:num+100};DBHelper.updateReviewsDb(r)}).catch(e=>{callback(e,null)})})})}static saveDatabase(e){return DBHelper.openDatabase().then(function(t){if(!t)return;let r=t.transaction("restaurantDb","readwrite"),a=r.objectStore("restaurantDb");return e.forEach(function(e){a.put(e)}),r.complete})}static updateDb(e,t){return DBHelper.openDatabase().then(t=>{return t.transaction("restaurantDb").objectStore("restaurantDb").get(e,"is_favorite")}).then(e=>{e.is_favorite=t,DBHelper.openDatabase().then(t=>{t.transaction("restaurantDb","readwrite").objectStore("restaurantDb").put(e)})})}static getCachedDb(){return(dbpromise=DBHelper.openDatabase()).then(function(e){if(!e)return;return e.transaction("restaurantDb").objectStore("restaurantDb").getAll()})}static fromApi(){return fetch(DBHelper.DATABASE_URL).then(function(e){return e.json()}).then(e=>(DBHelper.saveDatabase(e),e))}static fetchRestaurants(e){return DBHelper.getCachedDb().then(e=>e.length?Promise.resolve(e):DBHelper.fromApi()).then(t=>{e(null,t)}).catch(t=>{e(t,null)})}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((r,a)=>{const n=a.find(t=>t.id==e);n?t(null,n):t("Restaurant does not exist",null)})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((r,a)=>{if(r)t(r,null);else{const r=a.filter(t=>t.cuisine_type==e);t(null,r)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((r,a)=>{if(r)t(r,null);else{const r=a.filter(t=>t.neighborhood==e);t(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,r){DBHelper.fetchRestaurants((a,n)=>{if(a)r(a,null);else{let a=n;"all"!=e&&(a=a.filter(t=>t.cuisine_type==e)),"all"!=t&&(a=a.filter(e=>e.neighborhood==t)),r(null,a)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.map((e,t)=>r[t].neighborhood),a=t.filter((e,r)=>t.indexOf(e)==r);e(null,a)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.map((e,t)=>r[t].cuisine_type),a=t.filter((e,r)=>t.indexOf(e)==r);e(null,a)}})}static fetchReview(e){return fetch("http://localhost:1337/reviews").then(function(e){return e.json()}).then(t=>{e(null,t)}).catch(t=>{e(t,null)})}static fetchReviewById(e,t){return DBHelper.reviewsGetCached(e).then(t=>t.length>1?Promise.resolve(t):fetch("http://localhost:1337/reviews/?restaurant_id="+e).then(function(e){return e.json()}).then(e=>(DBHelper.saveReviewsDatabase(e),e))).then(e=>{t(null,e)}).catch(e=>{t(e,null)})}static postReviews(e){return fetch("http://localhost:1337/reviews/",{method:"POST",body:e}).then(function(e){return e.ok?e.json():[{}]})}static markFavorite(e){let t="";return"true"===self.restaurant.is_favorite?(t=`http://localhost:1337/restaurants/${e}/?is_favorite=true`,console.log(t)):"false"===self.restaurant.is_favorite&&(t=`http://localhost:1337/restaurants/${e}/?is_favorite=false`,console.log(t)),fetch(t,{method:"PUT"}).then(function(e){return e.ok?e.json():[{}]})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph}.webp`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}var map,markers=[];document.addEventListener("DOMContentLoaded",()=>{fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{null!=e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,r.setAttribute("aria-label",e),r.setAttribute("role","option"),t.append(r)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,r.setAttribute("aria-label",e),r.setAttribute("role","option"),t.append(r)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),r=e.selectedIndex,a=t.selectedIndex,n=e[r].value,s=t[a].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(n,s,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li");t.setAttribute("role","listitem"),t.setAttribute("tabindex","0");const r=document.createElement("img");r.className="restaurant-img",r.setAttribute("role","img"),r.dataset.src=DBHelper.imageUrlForRestaurant(e);const a=document.createElement("h2");a.innerHTML=e.name,r.setAttribute("aria-label",a.innerHTML+" restaurant"),r.setAttribute("alt",a.innerHTML+" restaurant"),t.append(r),t.append(a);const n=document.createElement("p");n.innerHTML=e.neighborhood,t.append(n);const s=document.createElement("p");s.innerHTML=e.address,t.append(s);const o=document.createElement("a");o.innerHTML="View Details",o.setAttribute("role","link"),o.href=DBHelper.urlForRestaurant(e),t.append(o);const i=document.createElement("span");return"true"===e.is_favorite?i.innerHTML+='<button tabindex="0" aria-label="Mark as favorite place" class="favorite" disabled></button>':i.innerHTML+='<button tabindex="0" aria-label="Mark as unfavorite place" class="un_favorite" disabled></button>',t.append(i),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJkYnByb21pc2UiLCJudW0iLCJyZXN0YXVyYW50cyIsIm5laWdoYm9yaG9vZHMiLCJjdWlzaW5lcyIsIkRCSGVscGVyIiwiREFUQUJBU0VfVVJMIiwiW29iamVjdCBPYmplY3RdIiwiaWRiIiwib3BlbiIsInVwZ3JhZGVEYiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiZGF0YSIsIm9wZW5SZXZpZXdEYXRhYmFzZSIsInRoZW4iLCJkYiIsInR4IiwidHJhbnNhY3Rpb24iLCJzdG9yZSIsIm9iamVjdFN0b3JlIiwiZm9yRWFjaCIsInJldmlldyIsInB1dCIsImNvbXBsZXRlIiwiaWQiLCJnZXRBbGwiLCJyZXMiLCJmaWx0ZXIiLCJyIiwicmVzdGF1cmFudF9pZCIsInBhcnNlSW50IiwibGVuZ3RoIiwiY2F0Y2giLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJhZGQiLCJvcGVuT3V0Ym94RGF0YWJhc2UiLCJyZXZpZXdzIiwibmF2aWdhdG9yIiwib25MaW5lIiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImNsZWFyT3V0Ym94IiwiY2xlYXIiLCJyZXNwb25zZSIsInJlc3VsdCIsInNlbGYiLCJwdXNoIiwibmFtZSIsInJhdGluZyIsImNvbW1lbnRzIiwiY3JlYXRlZEF0IiwidXBkYXRlUmV2aWV3c0RiIiwiZXIiLCJjYWxsYmFjayIsIm9wZW5EYXRhYmFzZSIsInJlc3RhdXJhbnQiLCJ2YWwiLCJnZXQiLCJvYmplY3QiLCJpc19mYXZvcml0ZSIsImpzb24iLCJzYXZlRGF0YWJhc2UiLCJnZXRDYWNoZWREYiIsIlByb21pc2UiLCJyZXNvbHZlIiwiZnJvbUFwaSIsImZldGNoUmVzdGF1cmFudHMiLCJmaW5kIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJtYXAiLCJ2IiwiaSIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwidW5pcXVlQ3Vpc2luZXMiLCJyZXZpZXdzR2V0Q2FjaGVkIiwic2F2ZVJldmlld3NEYXRhYmFzZSIsIm9rIiwibWFyayIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwibWFya2VycyIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImZldGNoTmVpZ2hib3Job29kcyIsImZldGNoQ3Vpc2luZXMiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJzZWxlY3QiLCJnZXRFbGVtZW50QnlJZCIsIm9wdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ2YWx1ZSIsInNldEF0dHJpYnV0ZSIsImFwcGVuZCIsImZpbGxDdWlzaW5lc0hUTUwiLCJ3aW5kb3ciLCJpbml0TWFwIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdCIsImxuZyIsInNjcm9sbHdoZWVsIiwidXBkYXRlUmVzdGF1cmFudHMiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsIm0iLCJzZXRNYXAiLCJ1bCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwiYWRkTWFya2Vyc1RvTWFwIiwibGkiLCJpbWFnZSIsImNsYXNzTmFtZSIsImRhdGFzZXQiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJiYWRnZSIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJldmVudCIsImFkZExpc3RlbmVyIiwibG9jYXRpb24iXSwibWFwcGluZ3MiOiJBQWtC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biAgICBcInJlcXVpcmVcIjoge1xuICAgICAgICBcIkZ1bmN0aW9uRGVjbGFyYXRpb25cIjogdHJ1ZSxcbiAgICAgICAgXCJNZXRob2REZWZpbml0aW9uXCI6IGZhbHNlLFxuICAgICAgICBcIkNsYXNzRGVjbGFyYXRpb25cIjogZmFsc2UsXG4gICAgICAgIFwiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb25cIjogZmFsc2UsXG4gICAgICAgIFwiRnVuY3Rpb25FeHByZXNzaW9uXCI6IGZhbHNlXG4gICAgfVxufV0qL1xuLyogZXNsaW50IHZhbGlkLWpzZG9jOiBcImVycm9yXCIqL1xuLyogZXNsaW50IG1heC1sZW46IFtcImVycm9yXCIsIHsgXCJjb2RlXCI6IDIwMCB9XSovXG4vKiBlc2xpbnQgbm8tdW51c2VkLXZhcnM6IFtcImVycm9yXCIsIHsgXCJ2YXJzXCI6IFwibG9jYWxcIiB9XSovXG4vKiBlc2xpbnQgYnJhY2Utc3R5bGU6IFswLHsgXCJhbGxvd1NpbmdsZUxpbmVcIjogdHJ1ZSB9XSovXG4vLyBpbXBvcnQgaWRiIGZyb20gXCJpZGJcIjtcblxuLyoqXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cbiAqL1xubGV0IGRicHJvbWlzZTtcbmxldCBudW07XG5jbGFzcyBEQkhlbHBlciB7XG4gIC8qXG4gICAqIERhdGFiYXNlIFVSTC5cbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxuICAgKi9cbi8vICBjb25zdCBwb3J0ID0gJzEzMzcnO1xuLy8gIGNvbnN0IGhvc3QgPSAnaHR0cDovL2xvY2FsaG9zdDonO1xuXG5cbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XG4gICAvKlxuICAgICogY29uc3QgcG9ydCA9IDgwMDAgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxuICAgICogcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vZGF0YS9yZXN0YXVyYW50cy5qc29uYDtcbiAgICAqL1xuICAgIGNvbnN0IHBvcnQgPSAxMzM3OyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSByZXN0YXVyYW50RGF0YWJhc2VcbiAgICovXG5cbiAgc3RhdGljIG9wZW5EYXRhYmFzZSgpIHtcbiAgICAvLyBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKXtcbiAgICAvLyAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIC8vIH1cblxuICAgIHJldHVybiBpZGIub3BlbigncmVzdGF1cmFudERiJywgMSwgZnVuY3Rpb24odXBncmFkZURiKSB7XG4gICAgICB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnREYicsIHtcbiAgICAgICAga2V5UGF0aDogJ2lkJ30pO1xuICAgICAgLy8gc3RvcmUuY3JlYXRlSW5kZXgoJ2J5LWlkJywnaWQnKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgUmV2aWV3IERhdGFiYXNlIVxuICAgKi9cblxuICAgc3RhdGljIG9wZW5SZXZpZXdEYXRhYmFzZSgpIHtcbiAgICAgcmV0dXJuIGlkYi5vcGVuKCdyZXZpZXdzRGInLCAxLCBmdW5jdGlvbih1cGdyYWRlRGIpIHtcbiAgICAgICB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3NEYicsIHtcbiAgICAgICAga2V5UGF0aDogJ2lkJ30pLmNyZWF0ZUluZGV4KCdyZXN0YXVyYW50X2lkJywgJ3Jlc3RhdXJhbnRfaWQnKTtcbiAgICAgfSk7XG4gICB9XG5cbiAgIC8qKlxuICAgICogU2F2ZSBkYXRhIHRvIFJldmlld3NEYXRhYmFzZVxuICAgICovXG5cbiAgIHN0YXRpYyBzYXZlUmV2aWV3c0RhdGFiYXNlKGRhdGEpIHtcbiAgICAgcmV0dXJuIERCSGVscGVyLm9wZW5SZXZpZXdEYXRhYmFzZSgpLnRoZW4oKGRiKSA9PiB7XG4gICAgICAgaWYgKCFkYikgcmV0dXJuO1xuICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzRGInLCAncmVhZHdyaXRlJyk7XG4gICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jldmlld3NEYicpO1xuICAgICAgIGRhdGEuZm9yRWFjaCgocmV2aWV3KSA9PiB7XG4gICAgICAgICBzdG9yZS5wdXQocmV2aWV3KTtcbiAgICAgICB9KTtcbiAgICAgICByZXR1cm4gdHguY29tcGxldGU7XG4gICAgIH0pO1xuICAgfVxuXG4gICAvKipcbiAgICAqIEdldHRpbmcgZGF0YSBmcm9tIFJldmlld3NEYXRhYmFzZVxuICAgICovXG5cbiAgIHN0YXRpYyByZXZpZXdzR2V0Q2FjaGVkKGlkKSB7XG4gICAgIGRicHJvbWlzZSA9IERCSGVscGVyLm9wZW5SZXZpZXdEYXRhYmFzZSgpO1xuICAgICByZXR1cm4gZGJwcm9taXNlLnRoZW4oKGRiKSA9PiB7XG4gICAgICAgaWYgKCFkYikgcmV0dXJuO1xuICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzRGInKTtcbiAgICAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmV2aWV3c0RiJyk7XG4gICAgICAgcmV0dXJuIHN0b3JlLmdldEFsbCgpO1xuICAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgICBudW09cmVzLmZpbHRlcigocikgPT4gci5yZXN0YXVyYW50X2lkPT1wYXJzZUludChpZCkpLmxlbmd0aDtcbiAgICAgICAvL2NvbnNvbGUubG9nKG51bSlcbiAgICAgICByZXR1cm4gcmVzLmZpbHRlcigocikgPT4gci5yZXN0YXVyYW50X2lkPT1wYXJzZUludChpZCkpO1xuICAgICB9KS5jYXRjaCgoZXJyb3IpID0+IGNvbnNvbGUubG9nKGVycm9yKSk7XG4gICB9XG5cbiAgIC8qKlxuICAgICogVXBkYXRlIHRoZSBSZXZpZXcgRGF0YWJhc2UgYWZ0ZXIgcG9zdCFcbiAgICAqL1xuXG4gICBzdGF0aWMgdXBkYXRlUmV2aWV3c0RiKHJldmlldykge1xuICAgICByZXR1cm4gREJIZWxwZXIub3BlblJldmlld0RhdGFiYXNlKCkudGhlbigoZGIpID0+IHtcbiAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmV2aWV3c0RiJywgJ3JlYWR3cml0ZScpO1xuICAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXZpZXdzRGInKTtcbiAgICAgICAvLyBsZXQgdGVtcCA9IHJldmlldztcbiAgICAgICByZXR1cm4gc3RvcmUuYWRkKHJldmlldyk7XG4gICAgIH0pO1xuICAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgT3V0Ym94IGRhdGFiYXNlIVxuICAgKi9cblxuICAgIHN0YXRpYyBvcGVuT3V0Ym94RGF0YWJhc2UoKSB7XG4gICAgICByZXR1cm4gaWRiLm9wZW4oJ291dGJveCcsIDEsIGZ1bmN0aW9uKHVwZ3JhZGVEYikge1xuICAgICAgICB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ291dGJveCcsIHtcbiAgICAgICAga2V5UGF0aDogJ2NyZWF0ZWRBdCd9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldmlldyBTYXZpbmcgb24gT3V0Ym94IERhdGFiYXNlXG4gICAgICovXG5cbiAgICBzdGF0aWMgc2F2ZU91dGJveERhdGFiYXNlKGRhdGEpIHtcbiAgICAgIHJldHVybiBEQkhlbHBlci5vcGVuT3V0Ym94RGF0YWJhc2UoKS50aGVuKChkYikgPT4ge1xuICAgICAgICBpZiAoIWRiKSByZXR1cm47XG4gICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdvdXRib3gnLCAncmVhZHdyaXRlJyk7XG4gICAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdvdXRib3gnKTtcbiAgICAgIC8vICBkYXRhLmZvckVhY2goKHJldmlldykgPT4ge1xuICAgICAgLy8gICAgc3RvcmUucHV0KHJldmlldyk7XG4gICAgICAvLyAgfSk7XG4gICAgICAgIHN0b3JlLnB1dChkYXRhKTtcbiAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogIENoZWNraW5nIHJldmlldyBhbmQgb25saW5lIHN0YXR1cyAmJiBzdWJtaXQgLSBQZW5kaW5nIGFjdGlvbiEhXG4gICAgICovXG5cbiAgICBzdGF0aWMgcGVuZGluZ0ZvclN1Ym1pdFJldmlld3MocmV2aWV3cykge1xuICAgICAgaWYgKG5hdmlnYXRvci5vbkxpbmUgJiYgcmV2aWV3cy5sZW5ndGg+MCkge1xuICAgICAgICByZXZpZXdzLmZvckVhY2goKHJldmlldykgPT4ge1xuICAgICAgICAgIGZldGNoKCdodHRwOi8vbG9jYWxob3N0OjEzMzcvcmV2aWV3cy8nLCB7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJldmlldyksXG4gICAgICAgICAgfSkudGhlbihjbGVhck91dGJveCgpKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xlYXJpbmcgT3V0Ym94IERhdGFiYXNlIVxuICAgICAqL1xuXG4gICAgc3RhdGljIGNsZWFyT3V0Ym94KCkge1xuICAgICAgaWYgKG5hdmlnYXRvci5vbkxpbmUpIHtcbiAgICAgIHJldHVybiBEQkhlbHBlci5vcGVuT3V0Ym94RGF0YWJhc2UoKS50aGVuKChkYikgPT57XG4gICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdvdXRib3gnLCAncmVhZHdyaXRlJyk7XG4gICAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdvdXRib3gnKTtcbiAgICAgICAgc3RvcmUuY2xlYXIoKTtcbiAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xuICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBPbmxpbmUgc3RhdHVzIGNoZWNrICYmIHN1Ym1pdCBwZW5kaW5nIHJldmlld3MhIVxuICAgICAqL1xuXG4gICAgc3RhdGljIHByb2Nlc3NBbGxQZW5kaW5nUmV2aWV3cygpIHtcbiAgICAgIGlmIChuYXZpZ2F0b3Iub25MaW5lKSB7XG4gICAgICAgIHJldHVybiBEQkhlbHBlci5vcGVuT3V0Ym94RGF0YWJhc2UoKS50aGVuKChkYikgPT4ge1xuICAgICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdvdXRib3gnKTtcbiAgICAgICAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgnb3V0Ym94Jyk7XG4gICAgICAgICAgcmV0dXJuIHN0b3JlLmdldEFsbCgpO1xuICAgICAgICB9KS50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIC8vIHBlbmRpbmdGb3JTdWJtaXRSZXZpZXdzKHJlc3BvbnNlKTtcbiAgICAgICAgICByZXNwb25zZS5mb3JFYWNoKGZ1bmN0aW9uKHJldmlldykge1xuICAgICAgICAgICAgLy9jb25zdCByZXYgPSB7XG4gICAgICAgICAgICAvLyAgJ3Jlc3RhdXJhbnRfaWQnOiByZXZpZXcucmVzdGF1cmFudF9pZCxcbiAgICAgICAgICAgIC8vICAnbmFtZSc6IHJldmlldy5uYW1lLFxuICAgICAgICAgICAgLy8gICdyYXRpbmcnOiByZXZpZXcucmF0aW5nLFxuICAgICAgICAgIC8vICAgICdjb21tZW50cyc6IHJldmlldy5jb21tZW50cyxcbiAgICAgICAgICAgIC8vICAnY3JlYXRlZEF0JzogcmV2aWV3LmNyZWF0ZWRBdFxuICAgICAgICAgIC8vICB9O1xuXG4gICAgICAgICAgICBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jldmlld3MvJywge1xuICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywgYm9keTogSlNPTi5zdHJpbmdpZnkocmV2aWV3KVxuICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgc2VsZi5yZXZpZXdzLnB1c2gocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAvLyBEQkhlbHBlci51cGRhdGVSZXZpZXdzRGIocmVzdWx0KTtcbiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgJ3Jlc3RhdXJhbnRfaWQnOiByZXZpZXcucmVzdGF1cmFudF9pZCxcbiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiByZXZpZXcubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgJ3JhdGluZyc6IHJldmlldy5yYXRpbmcsXG4gICAgICAgICAgICAgICAgICAgICdjb21tZW50cyc6IHJldmlldy5jb21tZW50cyxcbiAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWRBdCc6IHJldmlldy5jcmVhdGVkQXQsXG4gICAgICAgICAgICAgICAgICAgICdpZCc6IG51bSsxMDBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgREJIZWxwZXIudXBkYXRlUmV2aWV3c0RiKGRhdGEpO1xuICAgICAgICAgICAgICB9KS5jYXRjaCgoZXIpID0+IHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlciwgbnVsbCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgLypcbiAgKiBTYXZpbmcgb24gUmVzdGF1cmFudGRhdGFiYXNlXG4gICovXG4gIHN0YXRpYyBzYXZlRGF0YWJhc2UoZGF0YSkge1xuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uKGRiKSB7XG4gICAgICBpZiAoIWRiKSByZXR1cm47XG4gICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudERiJywgJ3JlYWR3cml0ZScpO1xuICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnREYicpO1xuICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKHJlc3RhdXJhbnQpIHtcbiAgICAgICAgc3RvcmUucHV0KHJlc3RhdXJhbnQpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gdHguY29tcGxldGU7XG4gICAgfSk7XG4gIH1cblxuXG4gIC8qXG4gICAqIFVwZGF0ZSBlbnRyeSBvbiBSZXN0YXVyYW50ZGF0YWJhc2UgIVxuICAgKi9cblxuICBzdGF0aWMgdXBkYXRlRGIoaWQsIHZhbCkge1xuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKChkYikgPT4ge1xuICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnREYicpO1xuICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnREYicpO1xuICAgICAgcmV0dXJuIHN0b3JlLmdldChpZCwgJ2lzX2Zhdm9yaXRlJyk7XG4gICAgfSkudGhlbigob2JqZWN0KSA9PiB7XG4gICAgICAgLy8gSURCIHRlc3Qgc2VhcmNoIG91dHB1dFxuICAgICAgLy8gY29uc29sZS5sb2cob2JqZWN0KTtcbiAgICAgIG9iamVjdC5pc19mYXZvcml0ZSA9IHZhbDtcbiAgICAgIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oKGRiKSA9PiB7XG4gICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50RGInLCAncmVhZHdyaXRlJyk7XG4gICAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50RGInKTtcbiAgICAgICAgc3RvcmUucHV0KG9iamVjdCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLypcbiAgKiBHZXR0aW5nIGRhdGEgZnJvbSBEQi1SZXN0YXVyYW50ZGF0YWJhc2VcbiAgKi9cbiAgc3RhdGljIGdldENhY2hlZERiKCkge1xuICAgIGRicHJvbWlzZSA9IERCSGVscGVyLm9wZW5EYXRhYmFzZSgpO1xuICAgIHJldHVybiBkYnByb21pc2UudGhlbihmdW5jdGlvbihkYikge1xuICAgICAgaWYgKCFkYikgcmV0dXJuO1xuICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnREYicpO1xuICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnREYicpO1xuICAgICAgcmV0dXJuIHN0b3JlLmdldEFsbCgpO1xuICAgIH0pO1xuICB9XG5cbiAgLypcbiAgICogc3RhZ2UyXG4gICAqL1xuICBzdGF0aWMgZnJvbUFwaSgpIHtcbiAgICByZXR1cm4gZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMKVxuICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIH0pLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICAgIERCSGVscGVyLnNhdmVEYXRhYmFzZShyZXN0YXVyYW50cyk7XG4gICAgICAgIHJldHVybiByZXN0YXVyYW50cztcbiAgICAgIH0pO1xuICB9XG5cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxuICAgKi9cblxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xuICAgIC8qKiBzdGFnZTFcbiAgICAqbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICp4aHIub3BlbignR0VUJywgREJIZWxwZXIuREFUQUJBU0VfVVJMKTtcbiAgICAqeGhyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAqICBpZiAoeGhyLnN0YXR1cyA9PT0gMjAwKSB7IC8vIEdvdCBhIHN1Y2Nlc3MgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIhXG4gICAgKiAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAqICAgIGNvbnN0IHJlc3RhdXJhbnRzID0ganNvbi5yZXN0YXVyYW50cztcbiAgICAqICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcbiAgICAqICB9IGVsc2UgeyAvLyBPb3BzIS4gR290IGFuIGVycm9yIGZyb20gc2VydmVyLlxuICAgICogICAgY29uc3QgZXJyb3IgPSAoYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWApO1xuICAgICogICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICogIH1cbiAgICAqfTtcbiAgICAqeGhyLnNlbmQoKTtcbiAgICAqKi9cblxuICAgLyoqIFRlc3RpbmcgZmV0Y2ggZnJvbSBkdW1teSBzZXJ2ZXJcbiAgICAqZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMKVxuICAgICogIC50aGVuKHJlc3BvbmQgPT4ge1xuICAgICogICAgaWYgKCFyZXNwb25kLm9rKXtcbiAgICAqICAgICAgdGhyb3cgXCJVbmFibGUgdG8gZmV0Y2ggZnJvbSBzZXJ2ZXIhXCI7XG4gICAgKiAgICB9XG4gICAgKiAgICByZXR1cm4gcmVzcG9uZC5qc29uKCk7XG4gICAgKiAgfSlcbiAgICAqICAudGhlbihyZXN0YXVyYW50cyA9PiBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cykpXG4gICAgKiAgLmNhdGNoKGUgPT4gY2FsbGJhY2soZSxudWxsKSlcbiAgICAqKi9cblxuICAgIHJldHVybiBEQkhlbHBlci5nZXRDYWNoZWREYigpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAocmVzdGF1cmFudHMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdGF1cmFudHMpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBEQkhlbHBlci5mcm9tQXBpKCk7XG4gICAgICB9XG4gICAgfSkudGhlbigocmVzdGF1cmFudHMpID0+IHtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXIpID0+IHtcbiAgICAgICAgY2FsbGJhY2soZXIsIG51bGwpO1xuICAgICAgfSk7XG4gICAgfVxuXG5cbiAgLyoqXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXG4gICAqL1xuXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAvLyAgaWYgKGVycm9yKSB7XG4gICAgLy8gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgIC8vICB9XG4gICAgLy8gIGVsc2Uge1xuICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZCgocikgPT4gci5pZCA9PSBpZCk7XG4gICAgICAgIGlmIChyZXN0YXVyYW50KSB7IC8vIEdvdCB0aGUgcmVzdGF1cmFudFxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgeyAvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxuICAgICAgICAgIGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cblxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKChyKSA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfVxuIGVsc2Uge1xuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKChyKSA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cblxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9XG4gZWxzZSB7XG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKChyKSA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoKHIpID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9XG4gZWxzZSB7XG4gICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpO1xuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG5cbiAgc3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqICBGZXRjaCBhbGwgcmV2aWV3c1xuICAgKi9cblxuICAgc3RhdGljIGZldGNoUmV2aWV3KGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIGZldGNoKCdodHRwOi8vbG9jYWxob3N0OjEzMzcvcmV2aWV3cycpXG4gICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgfSkudGhlbigocmV2aWV3cykgPT4ge1xuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVyKSA9PiB7XG4gICAgICAgICAgY2FsbGJhY2soZXIsIG51bGwpO1xuICAgICAgICB9KTtcbiAgIH1cblxuICAgLyoqXG4gICAgKiBGZXRjaCByZXZpZXcgYnkgcmVzdGF1cmFudCBpZFxuICAgICovXG4vKlxuICogV2l0aG91dCBDYWNoZWQgIVxuICpcbiAqICAgIHN0YXRpYyBmZXRjaFJldmlld0J5SWQoaWQsIGNhbGxiYWNrKSB7XG4gKiAgICAgIHJldHVybiBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jldmlld3MvP3Jlc3RhdXJhbnRfaWQ9JysgaWQpXG4gKiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAqICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICogICAgICAgICAgICByZXNwb25zZS5qc29uKClcbiAqICAgICAgICAgICAgLnRoZW4oKGpzb24pID0+IHtcbiAqICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBqc29uKTtcbiAqICAgICAgICAgICAgICByZXR1cm5cbiAqICAgICAgICAgICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7XG4gKiAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpXG4gKiAgICAgICAgICAgIH0pO1xuICogICAgICAgICAgfSBlbHNlIHtcbiAqICAgICAgICAgICAgY2FsbGJhY2soKGBSZXF1ZXN0IGZhaWxlZC4gUmV0dXJuZWQgc3RhdHVzIG9mICR7cmVzcG9uc2Uuc3RhdHVzfWApLCBudWxsKTtcbiAqICAgICAgICAgIH1cbiAqICAgICAgICB9XG4gKiAgICAgICkuY2F0Y2goKGVycm9yKSA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuICogICAgfVxuICovXG4gICAgc3RhdGljIGZldGNoUmV2aWV3QnlJZChpZCwgY2FsbGJhY2spIHtcbiAgICAgIHJldHVybiBEQkhlbHBlci5yZXZpZXdzR2V0Q2FjaGVkKGlkKS50aGVuKChyZXZpZXdzKSA9PiB7XG4gICAgICAgIGlmIChyZXZpZXdzLmxlbmd0aD4xKSB7XG4gICAgICAgICAgLy8gbGV0IGRhdGEgPSByZXZpZXdzLmZpbHRlcigocikgPT4gci5yZXN0YXVyYW50X2lkID09IHNlbGYucmVzdGF1cmFudC5pZCk7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXZpZXdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzLz9yZXN0YXVyYW50X2lkPScrIGlkKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIH0pLnRoZW4oKHJldmlld3MpID0+IHtcbiAgICAgICAgICAgICAgREJIZWxwZXIuc2F2ZVJldmlld3NEYXRhYmFzZShyZXZpZXdzKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHJldmlld3M7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSkudGhlbigocmV2aWV3cykgPT4ge1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKTtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSk7XG4gIH1cblxuXG4gIC8qKlxuICAgKiBQb3N0IFJldmlld3NcbiAgICovXG5cbiAgIHN0YXRpYyBwb3N0UmV2aWV3cyhyZXZpZXcpIHtcbiAgICAgcmV0dXJuIGZldGNoKCdodHRwOi8vbG9jYWxob3N0OjEzMzcvcmV2aWV3cy8nLCB7bWV0aG9kOiAnUE9TVCcsIGJvZHk6IHJldmlld30pXG4gICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBbe31dO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgIH1cblxuICAgLypcbiAgICAqIE1hcmsgRmF2b3JpdGUgUmVzdGF1cmFudHNcbiAgICAqL1xuICAgIHN0YXRpYyBtYXJrRmF2b3JpdGUocmVzdGF1cmFudCkge1xuICAgICAgbGV0IG1hcmsgPSAnJztcbiAgICAgIGlmIChzZWxmLnJlc3RhdXJhbnQuaXNfZmF2b3JpdGU9PT0ndHJ1ZScpIHtcbiAgICAgICAgbWFyayA9IGBodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHMvJHtyZXN0YXVyYW50fS8/aXNfZmF2b3JpdGU9dHJ1ZWA7XG4gICAgICAgIGNvbnNvbGUubG9nKG1hcmspO1xuICAgICAgfSBlbHNlIGlmIChzZWxmLnJlc3RhdXJhbnQuaXNfZmF2b3JpdGU9PT0nZmFsc2UnKSB7XG4gICAgICAgIG1hcmsgPSBgaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzLyR7cmVzdGF1cmFudH0vP2lzX2Zhdm9yaXRlPWZhbHNlYDtcbiAgICAgICAgY29uc29sZS5sb2cobWFyayk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmZXRjaChtYXJrLCB7bWV0aG9kOiAnUFVUJ30pXG4gICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICByZXR1cm4gW3t9XTtcbiAgICAgICAgICAgfVxuICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAvKipcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cbiAgICovXG5cbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cbiAgICovXG5cbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgLy8gcmV0dXJuIChgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH1gXG4vKlxuICAgICAgICBpZiAoTW9kZXJuaXpyLndlYnApIHtcbiAgICAgICAgICAvLyBzdXBwb3J0ZWRcbiAgICAgICAgICByZXR1cm4gKGAvZGlzdC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LndlYnBgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBub3Qtc3VwcG9ydGVkXG4gICAgICAgICAgcmV0dXJuIChgL2Rpc3QvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofS5qcGdgKTtcbiAgICAgICAgfVxuICAgICAgICAqL1xuICAgICAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofS53ZWJwYCk7XG4gICAgfVxuXG5cbiAgLyoqXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cbiAgICovXG5cbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxuICAgICAgbWFwOiBtYXAsXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QfVxuICAgICk7XG4gICAgcmV0dXJuIG1hcmtlcjtcbiAgfVxufVxuIiwiLyogZXNsaW50IG1heC1sZW46IFtcImVycm9yXCIsIHsgXCJjb2RlXCI6IDIwMCB9XSovXG4vKiBlc2xpbnQgbm8tdW51c2VkLXZhcnM6IFtcImVycm9yXCIsIHsgXCJ2YXJzXCI6IFwibG9jYWxcIiB9XSovXG5cbmxldCByZXN0YXVyYW50cztcbmxldCBuZWlnaGJvcmhvb2RzO1xubGV0IGN1aXNpbmVzO1xudmFyIG1hcDtcbnZhciBtYXJrZXJzID0gW107XG5cbi8qKlxuICogRmV0Y2ggbmVpZ2hib3Job29kcyBhbmQgY3Vpc2luZXMgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXG4gKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XG4gIGZldGNoTmVpZ2hib3Job29kcygpO1xuICBmZXRjaEN1aXNpbmVzKCk7XG59KTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cbmZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKChlcnJvciwgbmVpZ2hib3Job29kcykgPT4ge1xuICAgIGlmIChlcnJvciAhPSBudWxsKSB7IC8vIEdvdCBhbiBlcnJvclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxuICovXG5cbmZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuICBuZWlnaGJvcmhvb2RzLmZvckVhY2goKG5laWdoYm9yaG9vZCkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XG4gICAgb3B0aW9uLnZhbHVlID0gbmVpZ2hib3Job29kO1xuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBuZWlnaGJvcmhvb2QpO1xuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnb3B0aW9uJyk7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICAgIC8vIHNlbGVjdFswXS5zZXRBdHRyaWJ1dGUoJ2xhYmVsJyxzZWxlY3RbMF0uaW5uZXJIVE1MKTtcbiAgfSk7XG59O1xuXG4vKipcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cblxuZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcygoZXJyb3IsIGN1aXNpbmVzKSA9PiB7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLmN1aXNpbmVzID0gY3Vpc2luZXM7XG4gICAgICBmaWxsQ3Vpc2luZXNIVE1MKCk7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogU2V0IGN1aXNpbmVzIEhUTUwuXG4gKi9cblxuZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuXG4gIGN1aXNpbmVzLmZvckVhY2goKGN1aXNpbmUpID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcbiAgICBvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBjdWlzaW5lKTtcbiAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdyb2xlJywgJ29wdGlvbicpO1xuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcbiAgfSk7XG59O1xuXG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xuXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgbGV0IGxvYyA9IHtcbiAgICBsYXQ6IDQwLjcyMjIxNixcbiAgICBsbmc6IC03My45ODc1MDEsXG4gIH07XG5cbiAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgIHpvb206IDEyLFxuICAgIGNlbnRlcjogbG9jLFxuICAgIHNjcm9sbHdoZWVsOiBmYWxzZSxcbiAgfSk7XG5cbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcbn07XG5cbi8qKlxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cbiAqL1xuXG51cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XG5cbiAgLy8gY1NlbGVjdFswXS5zZXRBdHRyaWJ1dGUoJ2xhYmVsJyxjU2VsZWN0WzBdLmlubmVySFRNTCk7XG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcblxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXG4gKi9cblxucmVzZXRSZXN0YXVyYW50cyA9IChyZXN0YXVyYW50cykgPT4ge1xuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICB1bC5pbm5lckhUTUwgPSAnJztcblxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKChtKSA9PiBtLnNldE1hcChudWxsKSk7XG4gIHNlbGYubWFya2VycyA9IFtdO1xuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XG59O1xuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cblxuZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICByZXN0YXVyYW50cy5mb3JFYWNoKChyZXN0YXVyYW50KSA9PiB7XG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcbiAgfSk7XG4gIGFkZE1hcmtlcnNUb01hcCgpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxuICovXG5cbmNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBsaS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnbGlzdGl0ZW0nKTtcbiAgbGkuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG5cbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2ltZycpO1xuICBpbWFnZS5kYXRhc2V0LnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgLy8gaW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyYycsIERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSk7XG5cbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICAvKiB1bmlxdWUgYWx0IGZvciB0aGUgaW1hZ2UgKi9cbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgbmFtZS5pbm5lckhUTUwrJyByZXN0YXVyYW50Jyk7XG4gIGltYWdlLnNldEF0dHJpYnV0ZSgnYWx0JywgbmFtZS5pbm5lckhUTUwrJyByZXN0YXVyYW50Jyk7XG5cbiAgbGkuYXBwZW5kKGltYWdlKTtcbiAgbGkuYXBwZW5kKG5hbWUpO1xuXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcbiAgbGkuYXBwZW5kKGFkZHJlc3MpO1xuXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gIG1vcmUuaW5uZXJIVE1MID0gJ1ZpZXcgRGV0YWlscyc7XG4gIG1vcmUuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2xpbmsnKTtcbiAgbW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgbGkuYXBwZW5kKG1vcmUpO1xuICBjb25zdCBiYWRnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgaWYgKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGU9PT0ndHJ1ZScpIHtcbiAgICBiYWRnZS5pbm5lckhUTUwrPWA8YnV0dG9uIHRhYmluZGV4PVwiMFwiIGFyaWEtbGFiZWw9XCJNYXJrIGFzIGZhdm9yaXRlIHBsYWNlXCIgY2xhc3M9XCJmYXZvcml0ZVwiIGRpc2FibGVkPjwvYnV0dG9uPmA7XG4gIH0gZWxzZSB7XG4gICAgYmFkZ2UuaW5uZXJIVE1MKz1gPGJ1dHRvbiB0YWJpbmRleD1cIjBcIiBhcmlhLWxhYmVsPVwiTWFyayBhcyB1bmZhdm9yaXRlIHBsYWNlXCIgY2xhc3M9XCJ1bl9mYXZvcml0ZVwiIGRpc2FibGVkPjwvYnV0dG9uPmA7XG4gIH1cbiAgbGkuYXBwZW5kKGJhZGdlKTtcbiAgcmV0dXJuIGxpO1xufTtcblxuLyoqXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxuICovXG5cbmFkZE1hcmtlcnNUb01hcCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcbiAgcmVzdGF1cmFudHMuZm9yRWFjaCgocmVzdGF1cmFudCkgPT4ge1xuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsO1xuICAgIH0pO1xuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XG4gIH0pO1xufTtcbiJdLCJmaWxlIjoiaW5kZXgtbWluLmpzIn0=
